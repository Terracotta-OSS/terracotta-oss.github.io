<!DOCTYPE html ><html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Adding Terracotta Clustering to Quartz Scheduler</title><link rel="Prev" href="co-tqs_what_is_terracotta_quartz_scheduler.html" title="Previous"><link rel="Next" href="co-tqs_usage_notes.html" title="Next"><link rel="StyleSheet" href="css/_qs_all.css" type="text/css" media="all"><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all"><link rel="StyleSheet" href="css/social.css" type="text/css" media="all"><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all"><!--[if IE 7]><link rel="StyleSheet" href="css/_qs_all_IE7.css" type="text/css" media="all"><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print"><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if (window === window.top) {
        // Redirect
        //
        redirect_url = "../index.html#page/quartz-scheduler-webhelp/co-tqs_adding_terracotta_clustering_to_quartz_scheduler.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pOONl9_002f_002f5U1j2Sd9Hnb2CxQ" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/quartz-scheduler-webhelp/co-tqs_adding_terracotta_clustering_to_quartz_scheduler.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../quartz-scheduler-webhelp/_qs_all.1.095.html#wwconnect_header">Terracotta Quartz User Guide</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../quartz-scheduler-webhelp/to-tqs_using_terracotta_quartz_scheduler.html#wwconnect_header">Using Terracotta Quartz Scheduler</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_current">Adding Terracotta Clustering to Quartz Scheduler</span></div><div class="ww_skin_page_toolbar"></div></header><div id="ww3_12_3_9_1" class="Heading_2">Adding Terracotta Clustering to Quartz Scheduler</div><div id="ww3_12_3_9_3_2" class="Body">This document describes how to add Terracotta clustering to an application that is using Quartz Scheduler. Use this installation if you have been running your Quartz Scheduler application:</div><div id="ww3_12_3_9_3_4_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>on a single JVM, or</div><div id="ww3_12_3_9_3_4_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>on a cluster using JDBC-Jobstore.</div><div id="ww3_12_3_9_3_6" class="Body">To set up the cluster with Terracotta, you will add a Terracotta JAR to each application and run a Terracotta Server Array. Except as noted in this document, you can continue to use Quartz in your application as specified in the Quartz documentation.</div><div id="ww3_12_3_9_3_8_2" class="Section_Title">Prerequisites</div><div id="ww3_12_3_9_3_8_4_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>JDK 1.6 or higher.</div><div id="ww3_12_3_9_3_8_4_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>BigMemory Max 4.0.2 or higher. Download the kit and run the installer on the machine that will host the Terracotta Server.</div><div id="ww3_12_3_9_3_8_4_6" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>All clustered Quartz objects must be serializable. For example, if you create Quartz objects such as Trigger types, they must be serializable.</div><div id="ww3_12_3_9_3_10_2" class="Section_Title">Step 1: Install Quartz Scheduler</div><div id="ww3_12_3_9_3_10_4" class="Body">For guaranteed compatibility, use the JAR files included with the Terracotta kit you are installing. Mixing with older components may cause errors or unexpected behavior.</div><div id="ww3_12_3_9_3_10_6" class="Body">To install the Quartz Scheduler in your application, add the following JAR files to your application's classpath:</div><div id="ww3_12_3_9_3_10_8_2_3" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="codeph">${TERRACOTTA_HOME}/quartz/quartz-ee-&lt;quartz-version&gt;.jar</span></div><div id="ww3_12_3_9_3_10_8_2_5" class="List_1_Continued">&lt;quartz-version&gt; is the current version of Quartz (2.2.0 or higher).</div><div id="ww3_12_3_9_3_10_8_4_3" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="codeph">${TERRACOTTA_HOME}/common/terracotta-toolkit-runtime-ee-&lt;version&gt;.jar</span></div><div id="ww3_12_3_9_3_10_8_4_5" class="List_1_Continued">The Terracotta Toolkit JAR contains the Terracotta client libraries. &lt;version&gt; is the current version of the Terracotta Toolkit JAR (4.0.2 or higher).</div><div id="ww3_12_3_9_3_10_10" class="Body">If you are using a WAR file, add these JAR files to its <span class="codeph">WEB-INF/lib</span> directory.</div><div class="ww_skin_page_overflow"><table class="note1" summary=""><tr><td class="Table_Cell" style="padding-right: 6px; vertical-align: top"><div id="ww3_12_3_9_3_10_12_1_3_1_1_1" class="Note"><span style="font-weight: bold">Note:  </span>&nbsp;</div></td><td class="Table_Cell" style="padding-right: 6px; vertical-align: top"><div id="ww3_12_3_9_3_10_12_1_3_1_2_2" class="Table_Cell">Most application servers (or web containers) should work with this installation of the Quartz Scheduler. However, note the following:</div><div id="ww3_12_3_9_3_10_12_1_3_1_2_4_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>GlassFish application server – You must add <span class="codeph">&lt;jvm-options&gt;-Dcom.sun.enterprise.server.ss.ASQuickStartup=false&lt;/jvm-options&gt;</span> to domains.xml.</div><div id="ww3_12_3_9_3_10_12_1_3_1_2_4_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>WebLogic application server – You must use the supported versions of WebLogic. See support information on <span class="external"><a href="https://confluence.terracotta.org/display/release/Home" target="external_window">https://confluence.terracotta.org/display/release/Home</a></span>.</div></td></tr></table></div><div id="ww3_12_3_9_3_12_2" class="Section_Title">Step 2: Configure Quartz Scheduler</div><div id="ww3_12_3_9_3_12_4" class="Body">The Quartz configuration file, quartz.properties, by default, should be on your application's classpath. If you are using a WAR file, add the Quartz configuration file to WEB-INF/classes or to a JAR file that is included in WEB-INF/lib.</div><div id="ww3_12_3_9_3_14_2" class="Section_Title">Add Terracotta Configuration</div><div id="ww3_12_3_9_3_14_4" class="Body">To be clustered by Terracotta, the following properties in quartz.properties must be set as follows:</div><div id="ww3_12_3_9_3_14_6" class="Preformatted"># If you use the jobStore class TerracottaJobStore,     <br># Quartz Where will not be available.    <br>org.quartz.jobStore.class = org.terracotta.quartz.EnterpriseTerracottaJobStore    <br>org.quartz.jobStore.tcConfigUrl = &lt;path/to/Terracotta/configuration&gt;</div><div id="ww3_12_3_9_3_14_8" class="Body">The property <span class="parmname">org.quartz.jobStore.tcConfigUrl</span> must point the client (or application server) at the location of the Terracotta configuration.</div><div class="ww_skin_page_overflow"><table class="note1" summary=""><tr><td class="Table_Cell" style="padding-right: 6px; vertical-align: top"><div id="ww3_12_3_9_3_14_10_1_3_1_1_1" class="Note"><span style="font-weight: bold">Note:  </span>&nbsp;</div></td><td class="Table_Cell" style="padding-right: 6px; vertical-align: top"><div id="ww3_12_3_9_3_14_10_1_3_1_2" class="Table_Cell">In a Terracotta cluster, the application server is also known as the <span class="emphasis">client</span>.</div></td></tr></table></div><div id="ww3_12_3_9_3_14_12" class="Body">The client must load the configuration from a file or a Terracotta server. If loading from a server, give the server's hostname and its tsa-port (9510 by default), found in the Terracotta configuration. The following example shows a configuration that is loaded from the Terracotta server on the local host:</div><div id="ww3_12_3_9_3_14_14" class="Preformatted"># If you use the jobStore class TerracottaJobStore,     <br># Quartz Where will not be available.    <br>org.quartz.jobStore.class = org.terracotta.quartz.EnterpriseTerracottaJobStore <br>org.quartz.jobStore.tcConfigUrl = localhost:9510</div><div id="ww3_12_3_9_3_14_16" class="Body">To load Terracotta configuration from a Terracotta configuration file (tc-config.xml by default), use a path. For example, if the Terracotta configuration file is located on myHost.myNet.net at /usr/local/TerracottaHome, use the full URI along with the configuration file's name:</div><div id="ww3_12_3_9_3_14_18" class="Preformatted"># If you use the jobStore class TerracottaJobStore,     <br># Quartz Where will not be available.    <br>org.quartz.jobStore.class = org.terracotta.quartz.EnterpriseTerracottaJobStore    <br>org.quartz.jobStore.tcConfigUrl =     <br>            file://myHost.myNet.net/usr/local/TerracottaHome/tc-config.xml</div><div id="ww3_12_3_9_3_14_20" class="Body">If the Terracotta configuration source changes at a later time, it must be updated in configuration.</div><div id="ww3_12_3_9_3_16_2" class="Section_Title">Scheduler Instance Name</div><div id="ww3_12_3_9_3_16_4" class="Body">A Quartz scheduler has a default name configured by the following quartz.properties property:</div><div id="ww3_12_3_9_3_16_6" class="Preformatted">	org.quartz.scheduler.instanceName = QuartzScheduler</div><div id="ww3_12_3_9_3_16_8" class="Body">Setting this property is not required. However, you can use this property to instantiate and differentiate between two or more instances of the scheduler, each of which then receives a separate store in the Terracotta cluster.</div><div id="ww3_12_3_9_3_16_10" class="Body">Using different scheduler names allows you to isolate different job stores within the Terracotta cluster (logically unique scheduler instances). Using the same scheduler name allows different scheduler instances to share the same job store in the cluster.</div><div id="ww3_12_3_9_3_18_2" class="Section_Title">Step 3: Start the Cluster</div><div id="ww3_12_3_9_3_18_4_2_3" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>Start the Terracotta server:</div><div id="ww3_12_3_9_3_18_4_2_5" class="Numbered_1_Continued"><span class="inlinetitle">On UNIX/Linux</span></div><div id="ww3_12_3_9_3_18_4_2_7" class="Preformatted_1">[PROMPT] ${TERRACOTTA_HOME}/server/bin/start-tc-server.sh &amp;</div><div id="ww3_12_3_9_3_18_4_2_9" class="Numbered_1_Continued"><span class="inlinetitle">On Microsoft Windows</span></div><div id="ww3_12_3_9_3_18_4_2_11" class="Preformatted_1">[PROMPT] ${TERRACOTTA_HOME}\server\bin\start-tc-server.bat</div><div id="ww3_12_3_9_3_18_4_4" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>Start the application servers.</div><div id="ww3_12_3_9_3_18_4_6_3" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>To monitor the servers, start the Terracotta Management Console:</div><div id="ww3_12_3_9_3_18_4_6_5" class="Numbered_1_Continued"><span class="inlinetitle">On UNIX/Linux</span></div><div id="ww3_12_3_9_3_18_4_6_7" class="Preformatted_1">[PROMPT] ${TERRACOTTA_HOME}/tools/management-console/bin/start-tmc.sh &amp;</div><div id="ww3_12_3_9_3_18_4_6_9" class="Numbered_1_Continued"><span class="inlinetitle">On Microsoft Windows</span></div><div id="ww3_12_3_9_3_18_4_6_11" class="Preformatted_1">[PROMPT] ${TERRACOTTA_HOME}\tools\management-console\bin\start-tmc.bat</div><div id="ww3_12_3_9_3_20_2" class="Section_Title">Step 4: Edit the Terracotta Configuration</div><div id="ww3_12_3_9_3_20_4" class="Body">This step shows you how to run clients and servers on separate machines and add failover (High Availability). You will expand the Terracotta cluster and add High Availability by doing the following:</div><div id="ww3_12_3_9_3_20_6_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Moving the Terracotta server to its own machine</div><div id="ww3_12_3_9_3_20_6_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Creating a cluster with multiple Terracotta servers</div><div id="ww3_12_3_9_3_20_6_6" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Creating multiple application nodes</div><div id="ww3_12_3_9_3_20_8" class="Body">These tasks bring your cluster closer to a production architecture.</div><div id="ww3_12_3_9_3_22_2" class="Section_Title">Procedure:</div><div id="ww3_12_3_9_3_22_4_2_3" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>Shut down the Terracotta cluster.</div><div id="ww3_12_3_9_3_22_4_2_5" class="Numbered_1_Continued"><span class="inlinetitle">On UNIX/Linux</span></div><div id="ww3_12_3_9_3_22_4_2_7" class="Preformatted_1">[PROMPT] ${TERRACOTTA_HOME}/server/bin/stop-tc-server.sh</div><div id="ww3_12_3_9_3_22_4_2_9" class="Numbered_1_Continued"><span class="inlinetitle">On Microsoft Windows</span></div><div id="ww3_12_3_9_3_22_4_2_11" class="Preformatted_1">[PROMPT] ${TERRACOTTA_HOME}\server\bin\stop-tc-server.bat</div><div id="ww3_12_3_9_3_22_4_4_3" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>Create a Terracotta configuration file called tc-config.xml with contents similar to the following:</div><div id="ww3_12_3_9_3_22_4_4_5" class="Preformatted_1">&lt;?xml version="1.0" encoding="UTF-8"?&gt;    <br>&lt;con:tc-config xmlns:con="http://www.terracotta.org/config"&gt;    <br>  &lt;servers&gt;    <br>    &lt;mirror-group group-name="default-group"&gt;    <br>       &lt;!-- Sets where the Terracotta server can be found.     <br>        Replace the value of host with the server's IP address. --&gt;    <br>      &lt;server host="%i" name="server1"&gt;    <br>        &lt;offheap&gt;    <br>          &lt;enabled&gt;true&lt;/enabled&gt;    <br>          &lt;maxDataSize&gt;512M&lt;/maxDataSize&gt;    <br>        &lt;/offheap&gt;    <br>        &lt;tsa-port&gt;9510&lt;/tsa-port&gt;    <br>        &lt;jmx-port&gt;9520&lt;/jmx-port&gt;    <br>        &lt;data&gt;terracotta/data&lt;/data&gt;    <br>        &lt;logs&gt;terracotta/logs&lt;/logs&gt;    <br>        &lt;data-backup&gt;terracotta/backups&lt;/data-backup&gt;    <br>      &lt;/server&gt;    <br>       &lt;!-- If using a mirror Terracotta server, also referred to as an     <br>        ACTIVE-PASSIVE configuration, add the second server here. --&gt;    <br>      &lt;server host="%i" name="Server2"&gt;    <br>        &lt;offheap&gt;    <br>          &lt;enabled&gt;true&lt;/enabled&gt;    <br>          &lt;maxDataSize&gt;512M&lt;/maxDataSize&gt;    <br>        &lt;/offheap&gt;    <br>        &lt;tsa-port&gt;9511&lt;/tsa-port&gt;    <br>        &lt;data&gt;terracotta/data-dos&lt;/data&gt;    <br>        &lt;logs&gt;terracotta/logs-dos&lt;/logs&gt;    <br>        &lt;data-backup&gt;terracotta/backups-dos&lt;/data-backup&gt;    <br>      &lt;/server&gt;    <br>    &lt;/mirror-group&gt;    <br>    &lt;update-check&gt;    <br>      &lt;enabled&gt;false&lt;/enabled&gt;    <br>    &lt;/update-check&gt;    <br>    &lt;garbage-collection&gt;    <br>      &lt;enabled&gt;true&lt;/enabled&gt;           <br>    &lt;/garbage-collection&gt;    <br>    &lt;restartable enabled="true"/&gt;    <br>  &lt;/servers&gt;    <br>  &lt;!-- Sets where the generated client logs are saved on clients. --&gt;    <br>  &lt;clients&gt;    <br>    &lt;logs&gt;terracotta/logs&lt;/logs&gt;    <br>  &lt;/clients&gt;    <br>&lt;/con:tc-config&gt;</div><div id="ww3_12_3_9_3_22_4_6" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>Install BigMemory Max on a separate machine for each server you configure in tc-config.xml.</div><div id="ww3_12_3_9_3_22_4_8" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span>Copy the tc-config.xml to a location accessible to the Terracotta servers.</div><div id="ww3_12_3_9_3_22_4_10" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>5. </span></span>Perform <span class="heading-page"><a href="../quartz-scheduler-webhelp/co-tqs_adding_terracotta_clustering_to_quartz_scheduler.html#ww3_12_3_9_3_10_2" title="Adding Terracotta Clustering to Quartz Scheduler">Step 1: Install Quartz Scheduler</a></span>and <span class="heading-page"><a href="../quartz-scheduler-webhelp/co-tqs_adding_terracotta_clustering_to_quartz_scheduler.html#ww3_12_3_9_3_12_2" title="Adding Terracotta Clustering to Quartz Scheduler">Step 2: Configure Quartz Scheduler</a></span> on each application node you want to run in the cluster. Be sure to install your application and any application servers on each node.</div><div id="ww3_12_3_9_3_22_4_12" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>6. </span></span>Edit the <span class="codeph">org.quartz.jobStore.tcConfigUrl</span> property in quartz.properties to list both Terracotta servers: org.quartz.jobStore.tcConfigUrl = &lt;server.1.ip.address&gt;:9510,&lt;server.2.ip.address&gt;:9510</div><div id="ww3_12_3_9_3_22_4_14" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>7. </span></span>Copy quartz.properties to each application node and ensure that it is on your application's classpath. If you are using a WAR file, add the Quartz configuration file to WEB-INF/classes or to a JAR file that is included in WEB-INF/lib.</div><div id="ww3_12_3_9_3_22_4_16_3" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>8. </span></span>Start the Terracotta server in the following way, replacing "Server1" with the name you gave your server in tc-config.xml:</div><div id="ww3_12_3_9_3_22_4_16_5" class="Numbered_1_Continued"><span class="inlinetitle">On UNIX/Linux</span></div><div id="ww3_12_3_9_3_22_4_16_7" class="Preformatted_1">[PROMPT] ${TERRACOTTA_HOME}/server/bin/start-tc-server.sh \  <br>   -f &lt;path/to/tc-config.xml&gt; -n Server1 &amp;</div><div id="ww3_12_3_9_3_22_4_16_9" class="Numbered_1_Continued"><span class="inlinetitle">On Microsoft Windows</span></div><div id="ww3_12_3_9_3_22_4_16_11" class="Preformatted_1">[PROMPT] ${TERRACOTTA_HOME}\server\bin\start-tc-server.bat ^  <br>   -f &lt;path\to\tc-config.xml&gt; -n Server1 &amp;</div><div id="ww3_12_3_9_3_22_4_16-11" class="Numbered_1_Continued">If you configured a second server, start that server in the same way on its machine, entering its name after the <span class="codeph">-n</span> flag. The second server to start up becomes the mirror. Any other servers you configured will also start up as mirrors.</div><div id="ww3_12_3_9_3_22_4_18" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>9. </span></span>Start all application servers.</div><div id="ww3_12_3_9_3_22_4_20_3" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>10. </span></span>Start the Terracotta Management Server and view the cluster.</div><footer><!-- Related Topics --><!--                --><!-- Back to Top --><!--             --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br></footer><div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 11px; margin-top: 20px; margin-bottom: 20px;"><span class="xref"><a href="http://documentation.softwareag.com/legal/" target="external_window">Copyright © <span>2010</span><span>-2016</span><span></span><span></span> Software AG, Darmstadt, Germany</a></span>.</div><hr></div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 13px; font-weight: bold; margin-top: 20px;"><span><img style="vertical-align:middle" src="../connect/quartz_online.png" alt="Product Logo"><!--	     <a href="https://empower.softwareag.com/ContactSupport/default.asp" target="_blank" >Contact&#160;Support</a> --><!--         &#160;&#160;|&#160;&#160;  --><!--         <a href="http://www.softwareag.com/corporate/community/default.asp" target="_blank" >Community</a>  --><!--         &#160;&#160;  -->
          |&nbsp;&nbsp;
        <a href="mailto://documentation@softwareag.com" target="_blank">Feedback&nbsp;&nbsp;</a></span></div></body></html>