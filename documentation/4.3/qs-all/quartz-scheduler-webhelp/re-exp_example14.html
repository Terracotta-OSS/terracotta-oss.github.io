<!DOCTYPE html ><html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Example 14 - Trigger Priorities</title><link rel="Prev" href="re-exp_example6.html" title="Previous"><link rel="Next" href="to-snip_quartz_code_snippets.html" title="Next"><link rel="StyleSheet" href="css/_qs_all.css" type="text/css" media="all"><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all"><link rel="StyleSheet" href="css/social.css" type="text/css" media="all"><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all"><!--[if IE 7]><link rel="StyleSheet" href="css/_qs_all_IE7.css" type="text/css" media="all"><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print"><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if (window === window.top) {
        // Redirect
        //
        redirect_url = "../index.html#page/quartz-scheduler-webhelp/re-exp_example14.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pdKm5EMoBQMvZaXHxHyZFQQ" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/quartz-scheduler-webhelp/re-exp_example14.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../quartz-scheduler-webhelp/_qs_all.1.058.html#wwconnect_header">Quartz Scheduler Example Programs and Sample Code</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../quartz-scheduler-webhelp/to-exp_the_quartz_example_programs.html#wwconnect_header">The Quartz Example Programs</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_current">Example 14 - Trigger Priorities</span></div><div class="ww_skin_page_toolbar"></div></header><div id="ww3_11_3_19_1" class="Heading_2">Example 14 - Trigger Priorities</div><div id="ww3_11_3_19_3_2_2" class="Body">This example will demonstrate how you can use trigger priorities to manage firing order for triggers with the same fire time.</div><div id="ww3_11_3_19_3_2_4" class="Body">The program will perform the following actions:</div><div id="ww3_11_3_19_3_2_6_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Create a scheduler with a single worker thread</div><div id="ww3_11_3_19_3_2_6_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Schedule three triggers with different priorities that fire the first time at the same time, and a second time at staggered intervals</div><div id="ww3_11_3_19_3_2_6_6" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Start up the Quartz Scheduler</div><div id="ww3_11_3_19_3_2_6_8" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Wait for 30 seconds to give Quartz a chance to fire the triggers</div><div id="ww3_11_3_19_3_2_6_10" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Shut down the scheduler</div><div id="ww3_11_3_19_3_4_2" class="Section_Title">Running the Example</div><div id="ww3_11_3_19_3_4_4" class="Body">This example can be executed from the <span class="filepath">examples/example14</span> directory. There are two ways to run this example</div><div id="ww3_11_3_19_3_4_6_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>example14.sh - A UNIX/Linux shell script</div><div id="ww3_11_3_19_3_4_6_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>example14.bat - A Windows Batch file</div><div id="ww3_11_3_19_3_6_2" class="Section_Title">Expected Results</div><div id="ww3_11_3_19_3_6_4" class="Body">Each of the three triggers should fire twice. Once in order of priority, as they all start at the same time, and a second time in order of their staggered firing times. You should see something like this in the log or on the console:</div><div id="ww3_11_3_19_3_6_6" class="Preformatted">INFO 15 Aug 12:15:51.345 PM PriorityExampleScheduler_Worker-0   <br>     org.quartz.examples.example14.TriggerEchoJob     <br>TRIGGER: Priority10Trigger15SecondRepeat     <br>INFO 15 Aug 12:15:51.345 PM PriorityExampleScheduler_Worker-0    <br>     org.quartz.examples.example14.TriggerEchoJob     <br>TRIGGER: Priority5Trigger10SecondRepeat     <br>INFO 15 Aug 12:15:51.345 PM PriorityExampleScheduler_Worker-0    <br>     org.quartz.examples.example14.TriggerEchoJob     <br>TRIGGER: PriorityNeg5Trigger5SecondRepeat     <br>INFO 15 Aug 12:15:56.220 PM PriorityExampleScheduler_Worker-0    <br>     org.quartz.examples.example14.TriggerEchoJob     <br>TRIGGER: PriorityNeg5Trigger5SecondRepeat     <br>INFO 15 Aug 12:16:01.220 PM PriorityExampleScheduler_Worker-0    <br>     org.quartz.examples.example14.TriggerEchoJob     <br>TRIGGER: Priority5Trigger10SecondRepeat     <br>INFO 15 Aug 12:16:06.220 PM PriorityExampleScheduler_Worker-0    <br>     org.quartz.examples.example14.TriggerEchoJob     <br>TRIGGER: Priority10Trigger15SecondRepeat</div><div id="ww3_11_3_19_3_8_2" class="Section_Title">The Code</div><div id="ww3_11_3_19_3_8_4" class="Body">The code for this example resides in the package org.quartz.examples.example14.</div><div id="ww3_11_3_19_3_8_6" class="Body">The code in this example is made up of the following classes:</div><div class="ww_skin_page_overflow"><table class="Default" summary=""><tr><td class="Table_Cell_Head" style="background-color: #D6D6D6; border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: Black; border-left-style: solid; border-left-width: 1px; border-right-color: Black; border-right-style: solid; border-right-width: 1px; border-top-color: Black; border-top-style: solid; border-top-width: 1px; padding-bottom: 3px; padding-left: 8px; padding-right: 8px; padding-top: 0px; vertical-align: bottom; width: 108pt"><div id="ww3_11_3_19_3_10_2_3_2_2" class="Table_Cell_Head">Class Name</div></td><td class="Table_Cell_Head" style="background-color: #D6D6D6; border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: Black; border-left-style: solid; border-left-width: 1px; border-right-color: Black; border-right-style: solid; border-right-width: 1px; border-top-color: Black; border-top-style: solid; border-top-width: 1px; padding-bottom: 3px; padding-left: 8px; padding-right: 8px; padding-top: 0px; vertical-align: bottom; width: 324pt"><div id="ww3_11_3_19_3_10_2_3_2_4" class="Table_Cell_Head">Description</div></td></tr><tr><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: Black; border-left-style: solid; border-left-width: 1px; border-right-color: Black; border-right-style: solid; border-right-width: 1px; border-top-color: Black; border-top-style: solid; border-top-width: 1px; padding-bottom: 3px; padding-left: 8px; padding-right: 8px; padding-top: 0px; vertical-align: top"><div id="ww3_11_3_19_3_10_2_5_2_2" class="Table_Cell">PriorityExample</div></td><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: Black; border-left-style: solid; border-left-width: 1px; border-right-color: Black; border-right-style: solid; border-right-width: 1px; border-top-color: Black; border-top-style: solid; border-top-width: 1px; padding-bottom: 3px; padding-left: 8px; padding-right: 8px; padding-top: 0px; vertical-align: top"><div id="ww3_11_3_19_3_10_2_5_2_4" class="Table_Cell">The main program.</div></td></tr><tr><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: Black; border-left-style: solid; border-left-width: 1px; border-right-color: Black; border-right-style: solid; border-right-width: 1px; border-top-color: Black; border-top-style: solid; border-top-width: 1px; padding-bottom: 3px; padding-left: 8px; padding-right: 8px; padding-top: 0px; vertical-align: top"><div id="ww3_11_3_19_3_10_2_5_4_2" class="Table_Cell">TriggerEchoJob</div></td><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: Black; border-left-style: solid; border-left-width: 1px; border-right-color: Black; border-right-style: solid; border-right-width: 1px; border-top-color: Black; border-top-style: solid; border-top-width: 1px; padding-bottom: 3px; padding-left: 8px; padding-right: 8px; padding-top: 0px; vertical-align: top"><div id="ww3_11_3_19_3_10_2_5_4_4" class="Table_Cell">A simple job that echoes the name if the Trigger that fired it.</div></td></tr></table></div><div id="ww3_11_3_19_3_12_2" class="Section_Title">TriggerEchoJob</div><div id="ww3_11_3_19_3_12_4" class="Body">TriggerEchoJob is a simple job that implements the Job interface and writes the name of the trigger that fired it to the log (by default, this will simply go to the screen):</div><div id="ww3_11_3_19_3_12_6" class="Preformatted">public void execute(JobExecutionContext context) throws JobExecutionException {     <br>    LOG.info("TRIGGER: " + context.getTrigger().getKey());     <br>}</div><div id="ww3_11_3_19_3_14_2" class="Section_Title">PriorityExample</div><div id="ww3_11_3_19_3_14_4" class="Body">The program starts by getting an instance of the Scheduler. This is done by creating a StdSchedulerFactory and then using it to create a scheduler.</div><div id="ww3_11_3_19_3_14_6" class="Preformatted">SchedulerFactory sf = new StdSchedulerFactory(     <br>    "org/quartz/examples/example14/quartz_priority.properties");     <br>Scheduler sched = sf.getScheduler();</div><div id="ww3_11_3_19_3_14_8" class="Body">We pass a specific Quartz properties file to the StdSchedulerFactory to configure our new Scheduler instance. These properties will create a RAM-based scheduler with only one worker thread so that we can see priorities act as the tie breaker when triggers compete for the single thread, quartz_priority.properties:</div><div id="ww3_11_3_19_3_14_10" class="Preformatted">org.quartz.scheduler.instanceName=PriorityExampleScheduler     <br># Set thread count to 1 to force Triggers scheduled for the same time to     <br># to be ordered by priority.     <br>org.quartz.threadPool.threadCount=1     <br>org.quartz.threadPool.class=org.quartz.simpl.SimpleThreadPool     <br>org.quartz.jobStore.class=org.quartz.simpl.RAMJobStore</div><div id="ww3_11_3_19_3_14_12" class="Body">The TriggerEchoJob is defined as a job to Quartz using the JobDetail class. As shown below, it passes "null" for its group, so it will use the default group:</div><div id="ww3_11_3_19_3_14_14" class="Preformatted">JobDetail job = new JobDetail("TriggerEchoJob", null, TriggerEchoJob.class);</div><div id="ww3_11_3_19_3_14_16" class="Body">We create three SimpleTriggers that will all fire the first time five seconds from now but with different priorities, and then fire a second time at staggered five second intervals:</div><div id="ww3_11_3_19_3_14_18" class="Preformatted">// Calculate the start time of all triggers as 5 seconds from now     <br>Date startTime = futureDate(5, IntervalUnit.SECOND);     <br>// First trigger has priority of 1, and will repeat after 5 seconds     <br>Trigger trigger1 = newTrigger()     <br>    .withIdentity("PriorityNeg5Trigger5SecondRepeat")     <br>    .startAt(startTime)     <br>    .withSchedule(simpleSchedule().withRepeatCount(1).withIntervalInSeconds(5))     <br>    .withPriority(1)     <br>    .forJob(job)     <br>    .build();     <br>// Second trigger has default priority of 5 (default), and will repeat after 10 seconds     <br>Trigger trigger2 = newTrigger()     <br>    .withIdentity("Priority5Trigger10SecondRepeat")     <br>    .startAt(startTime)     <br>    .withSchedule(simpleSchedule().withRepeatCount(1).withIntervalInSeconds(10))     <br>    .forJob(job)     <br>    .build();     <br>// Third trigger has priority 10, and will repeat after 15 seconds     <br>Trigger trigger3 = newTrigger()     <br>    .withIdentity("Priority10Trigger15SecondRepeat")     <br>    .startAt(startTime)     <br>    .withSchedule(simpleSchedule().withRepeatCount(1).withIntervalInSeconds(15))     <br>    .withPriority(10)     <br>    .forJob(job)     <br>    .build();</div><div id="ww3_11_3_19_3_14_20" class="Body">We now associate the three triggers with our job in the scheduler. The first time we need to also add the job itself to the scheduler:</div><div id="ww3_11_3_19_3_14_22" class="Preformatted">// Tell quartz to schedule the job using our trigger     <br>sched.scheduleJob(job, trigger1);     <br>sched.scheduleJob(trigger2);     <br>sched.scheduleJob(trigger3);</div><div id="ww3_11_3_19_3_14_24" class="Body">At this point, the triggers have been scheduled to run. However, the scheduler is not yet running, so we must tell it to start up.</div><div id="ww3_11_3_19_3_14_26" class="Preformatted">sched.start();</div><div id="ww3_11_3_19_3_14_28" class="Body">To let the scheduler have an opportunity to run the job, our program sleeps for 30 seconds. The scheduler is running in the background and should fire the job six times during those 30 seconds.</div><div id="ww3_11_3_19_3_14_30" class="Preformatted">Thread.sleep(30L * 1000L);</div><div id="ww3_11_3_19_3_14_32" class="Body">Finally, the program gracefully shuts down the scheduler:</div><div id="ww3_11_3_19_3_14_34" class="Preformatted">sched.shutdown(true);</div><div class="ww_skin_page_overflow"><table class="note1" summary=""><tr><td class="Table_Cell" style="padding-right: 6px; vertical-align: top"><div id="ww3_11_3_19_3_14_36_1_3_1_1_1" class="Note"><span style="font-weight: bold">Note:  </span>&nbsp;</div></td><td class="Table_Cell" style="padding-right: 6px; vertical-align: top"><div id="ww3_11_3_19_3_14_36_1_3_1_2" class="Table_Cell">Passing "true" to the shutdown method tells Quartz Scheduler to wait until all jobs have completed running before returning from the method call.</div></td></tr></table></div><footer><!-- Related Topics --><!--                --><!-- Back to Top --><!--             --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br></footer><div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 11px; margin-top: 20px; margin-bottom: 20px;"><span class="xref"><a href="http://documentation.softwareag.com/legal/" target="external_window">Copyright © <span>2010</span><span>-2016</span><span></span><span></span> Software AG, Darmstadt, Germany</a></span>.</div><hr></div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 13px; font-weight: bold; margin-top: 20px;"><span><img style="vertical-align:middle" src="../connect/quartz_online.png" alt="Product Logo"><!--	     <a href="https://empower.softwareag.com/ContactSupport/default.asp" target="_blank" >Contact&#160;Support</a> --><!--         &#160;&#160;|&#160;&#160;  --><!--         <a href="http://www.softwareag.com/corporate/community/default.asp" target="_blank" >Community</a>  --><!--         &#160;&#160;  -->
          |&nbsp;&nbsp;
        <a href="mailto://documentation@softwareag.com" target="_blank">Feedback&nbsp;&nbsp;</a></span></div></body></html>