<!DOCTYPE html ><html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Usage Notes</title><link rel="Prev" href="co-tqs_adding_terracotta_clustering_to_quartz_scheduler.html" title="Previous"><link rel="Next" href="to-qsw_using_quartz_scheduler_where.html" title="Next"><link rel="StyleSheet" href="css/_qs_all.css" type="text/css" media="all"><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all"><link rel="StyleSheet" href="css/social.css" type="text/css" media="all"><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all"><!--[if IE 7]><link rel="StyleSheet" href="css/_qs_all_IE7.css" type="text/css" media="all"><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print"><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if (window === window.top) {
        // Redirect
        //
        redirect_url = "../index.html#page/quartz-scheduler-webhelp/co-tqs_usage_notes.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pGk1EJYho8bTSdjgqDl4_002btg" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/quartz-scheduler-webhelp/co-tqs_usage_notes.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../quartz-scheduler-webhelp/_qs_all.1.095.html#wwconnect_header">Terracotta Quartz User Guide</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../quartz-scheduler-webhelp/to-tqs_using_terracotta_quartz_scheduler.html#wwconnect_header">Using Terracotta Quartz Scheduler</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_current">Usage Notes</span></div><div class="ww_skin_page_toolbar"></div></header><div id="ww3_12_3_11_1" class="Heading_2">Usage Notes</div><div id="ww3_12_3_11_3_2" class="Body">This topic contains information on functional aspects of Terracotta Quartz Scheduler and optimizing your use of TerracottaJobstore for Quartz Scheduler.</div><div id="ww3_12_3_11_3_4_2" class="Section_Title">Execution of Jobs</div><div id="ww3_12_3_11_3_4_4" class="Body">In the general case, exactly one Quartz Scheduler node, or Terracotta client, executes a clustered job when that job's trigger fires. This can be any of the nodes that have the job. If a job repeats, it may be executed by any of the nodes that have it exactly once per the interval configured. It is not possible to predict which node will execute the job.</div><div id="ww3_12_3_11_3_4_6" class="Body">With Quartz Scheduler Where, a job can be assigned to a specific node based on certain criteria.</div><div id="ww3_12_3_11_3_6_2" class="Section_Title">Working With JobDataMaps</div><div id="ww3_12_3_11_3_6_4" class="Body">JobDataMaps contain data that may be useful to jobs at execution time. A JobDataMap is stored at the time its associated job is added to a scheduler.</div><div id="ww3_12_3_11_3_8_2" class="Section_Title">Updating a JobDataMap</div><div id="ww3_12_3_11_3_8_4" class="Body">If the stored job is stateful (meaning that it implements the StatefulJob interface), and the contents of its JobDataMap is updated (from within the job) during execution, then a new copy of the JobDataMap is stored when the job completes.</div><div id="ww3_12_3_11_3_8_6" class="Body">If the job is not stateful, then it must be explicitly stored again with the changed JobDataMap to update the stored copy of the job's JobDataMap. This is because TerracottaJobStore contains deep copies of JobDataMap objects and does not reflect updates made after a JobDataMap is stored.</div><div id="ww3_12_3_11_3_10_2" class="Section_Title">Best Practices for Storing Objects in a JobDataMap</div><div id="ww3_12_3_11_3_10_4" class="Body">Because TerracottaJobStore contains deep copies of JobDataMap objects, application code should not have references to mutable JobDataMap objects. If an application relies on these references, there is risk of getting stale data as the mutable objects in a deep copy do not reflect changes made to the JobDataMap after it is stored.</div><div id="ww3_12_3_11_3_10_6" class="Body">To maximize performance and ensure long-term compatibility, place only Strings and primitives in JobDataMap. JobDataMap objects are serialized and prone to class-versioning issues. Putting complex objects into a clustered JobDataMap could also introduce other errors that are avoided with Strings and primitives.</div><div id="ww3_12_3_11_3_12_2" class="Section_Title">Cluster Data Safety</div><div id="ww3_12_3_11_3_12_4" class="Body">By default, Terracotta clients (application servers) do not block to wait for a "transaction received" acknowledgment from a Terracotta server when writing data transactions to the cluster. This asynchronous write mode translates into better performance in a Terracotta cluster.</div><div id="ww3_12_3_11_3_12_6" class="Body">However, the option to maximize data safety by requiring an acknowledgment is available using the following Quartz configuration property:</div><div id="ww3_12_3_11_3_12_8" class="Body"><span class="parmname">org.quartz.jobStore.synchronousWrite&nbsp;=&nbsp;true</span></div><div id="ww3_12_3_11_3_12_10" class="Body">When <span class="parmname">synchronousWrite</span> is set to "true", a client blocks with each transaction written to the cluster until an acknowledgment is received from a Terracotta server. This ensures that the transaction is committed in the cluster before the client continues work.</div><div id="ww3_12_3_11_3_14_2" class="Section_Title">Effective Scaling Strategies</div><div id="ww3_12_3_11_3_14_4" class="Body">Clustering Quartz schedulers is an effective approach to distributing load over a number of nodes if jobs are long-running or are CPU intensive (or both). Distributing the jobs lessens the burden on system resources. In this case, and with a small set of jobs, lock contention is usually infrequent.</div><div id="ww3_12_3_11_3_14_6" class="Body">However, using a single scheduler forces the use of a cluster-wide lock, a pattern that degrades performance as you add more clients. The cost of this cluster-wide lock becomes more evident if a large number of short-lived jobs are being fired by a single scheduler. In this case, consider partitioning the set of jobs across more than one scheduler.</div><div id="ww3_12_3_11_3_14_8" class="Body">If you do employ multiple schedulers, they can be run on every node, striping the cluster-wide locks. This is an effective way to reduce lock contention while adding scale.</div><div id="ww3_12_3_11_3_14_10" class="Body">If you intend to scale, measure your cluster's throughput in a test environment to discover the optimal number of schedulers and nodes.</div><footer><!-- Related Topics --><!--                --><!-- Back to Top --><!--             --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br></footer><div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 11px; margin-top: 20px; margin-bottom: 20px;"><span class="xref"><a href="http://documentation.softwareag.com/legal/" target="external_window">Copyright Â© <span>2010</span><span>-2016</span><span></span><span></span> Software AG, Darmstadt, Germany</a></span>.</div><hr></div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 13px; font-weight: bold; margin-top: 20px;"><span><img style="vertical-align:middle" src="../connect/quartz_online.png" alt="Product Logo"><!--	     <a href="https://empower.softwareag.com/ContactSupport/default.asp" target="_blank" >Contact&#160;Support</a> --><!--         &#160;&#160;|&#160;&#160;  --><!--         <a href="http://www.softwareag.com/corporate/community/default.asp" target="_blank" >Community</a>  --><!--         &#160;&#160;  -->
          |&nbsp;&nbsp;
        <a href="mailto://documentation@softwareag.com" target="_blank">Feedback&nbsp;&nbsp;</a></span></div></body></html>