<!DOCTYPE html ><html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Using Rejoin to Reconnect Terracotta Clients</title><link rel="Prev" href="co-rc_special_client_connect_properties.html" title="Previous"><link rel="Next" href="co-rc_effective_reconnection_settings.html" title="Next"><link rel="StyleSheet" href="css/aaa_bigmem_max_all.css" type="text/css" media="all"><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all"><link rel="StyleSheet" href="css/social.css" type="text/css" media="all"><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all"><!--[if IE 7]><link rel="StyleSheet" href="css/aaa_bigmem_max_all_IE7.css" type="text/css" media="all"><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print"><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if (window === window.top) {
        // Redirect
        //
        redirect_url = "../index.html#page/bigmemory-max-webhelp/co-rc_client_failover_after_server_failure.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pN3NLojMJAKdGNNssPkYg_002f6g" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/bigmemory-max-webhelp/co-rc_client_failover_after_server_failure.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../bigmemory-max-webhelp/to-title_product_documentation.html#wwconnect_header">Product Documentation</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../bigmemory-max-webhelp/to-title_bigmemory_max_ha_guide.html#wwconnect_header">BigMemory Max High-Availability Guide</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../bigmemory-max-webhelp/to-rc_configuring_reconnect_properties.html#wwconnect_header">Configuring Reconnection and Rejoin Properties</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_current">Using Rejoin to Reconnect Terracotta Clients</span></div><div class="ww_skin_page_toolbar"></div></header><div id="ww3_17_16_11_12_1" class="Heading_3">Using Rejoin to Reconnect Terracotta Clients</div><div id="ww3_17_16_11_12_3_2" class="Body">A Terracotta client may disconnect and be timed out (ejected) from the cluster. Typically, this occurs because of network communication interruptions lasting longer than the configured HA settings for the cluster. Other causes include long GC pauses and slowdowns introduced by other processes running on the client hardware.</div><div id="ww3_17_16_11_12_3_4" class="Body">You can configure clients to automatically rejoin a cluster after they are ejected. If the ejected client continues to run under nonstop cache settings, and then senses that it has reconnected to the cluster (receives a clusterOnline event), it can begin the rejoin process.</div><div id="ww3_17_16_11_12_3_6" class="Body">Note the following about using the rejoin feature:</div><div id="ww3_17_16_11_12_3_8_2_3" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Disconnected clients can only rejoin clusters to which they were previously connected.</div><div id="ww3_17_16_11_12_3_8_4_3" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Clients rejoin as new members and will wipe all cached data to ensure that no pauses or inconsistencies are introduced into the cluster.</div><div id="ww3_17_16_11_12_3_8_6_3" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Clients cannot rejoin a new cluster; if the TSA has been restarted and its data has not been persisted, clients can never rejoin and must be restarted.</div><div id="ww3_17_16_11_12_3_8_8_3" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>If the TSA has been restarted and its data has been persisted, clients are allowed to rejoin.</div><div id="ww3_17_16_11_12_3_8_10_3" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Any nonstop-related operations that begin (and do not complete) before the rejoin operation completes may be unsuccessful and may generate a NonStopCacheException.</div><div id="ww3_17_16_11_12_3_8_12_3" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>If a Terracotta client with rejoin enabled is running in a JVM with clients that do not have rejoin, then only that client will rejoin after a disconnection. The remaining clients cannot rejoin and may cause the application to behave unpredictably.</div><div id="ww3_17_16_11_12_3_8_14_3" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Once a client rejoins, the clusterRejoined event is fired on that client only.</div><div id="ww3_17_16_11_12_3_10_2" class="Section_Title">Configuring Rejoin</div><div id="ww3_17_16_11_12_3_10_4" class="Body">The rejoin feature is disabled by default. To enable the rejoin feature in an Terracotta client, follow these steps:</div><div id="ww3_17_16_11_12_3_10_6_2_3" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>Ensure that all of the caches in the Ehcache configuration file where rejoin is enabled have nonstop enabled.</div><div id="ww3_17_16_11_12_3_10_6_4_3" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>Ensure that your application does not create caches on the client without nonstop enabled.</div><div id="ww3_17_16_11_12_3_10_6_6_3" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>Enable the rejoin attribute in the client's <span class="codeph">&lt;terracottaConfig&gt;</span> element:</div><div id="ww3_17_16_11_12_3_10_6_6_5" class="Preformatted_1">&lt;terracottaConfig url="myHost:9510" rejoin="true" /&gt;</div><div id="ww3_17_16_11_12_3_10_8" class="Body">For more options on configuring <span class="codeph">&lt;terracottaConfig&gt;</span>, see "Terracotta Clustering Configuration Elements" in the <span class="Citation">BigMemory Max Configuration Guide</span>. </div><div id="ww3_17_16_11_12_3_12_2" class="Section_Title">Exception During Rejoin</div><div id="ww3_17_16_11_12_3_12_4" class="Body">Under certain circumstances, if a lock is being used by your application, an InvalidLockAfterRejoinException could be thrown during or after client rejoin. This exception occurs when an unlock operation takes place on a lock obtained <span class="emphasis">before</span> the rejoin attempt completed.</div><div id="ww3_17_16_11_12_3_12_6" class="Body">To ensure that locks are released properly, application code should encapsulate lock-unlock operations with try-finally blocks:</div><div id="ww3_17_16_11_12_3_12_8" class="Preformatted">myLock.acquireLock();<br>try {<br>  // Do some work.<br>} finally {<br>  myLock.unlock();<br>}<br></div><footer><!-- Related Topics --><!--                --><!-- Back to Top --><!--             --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br></footer><div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 11px; margin-top: 20px; margin-bottom: 20px;"><span class="xref"><a href="http://documentation.softwareag.com/legal/" target="external_window">Copyright Â© <span>2010</span><span>-2016</span><span></span><span></span> Software AG, Darmstadt, Germany</a></span>.</div><hr></div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 13px; font-weight: bold; margin-top: 20px;"><span><img style="vertical-align:middle" src="../connect/terracotta_online.png" alt="Product Logo"><a href="https://empower.softwareag.com/ContactSupport/default.asp" target="_blank">Contact&nbsp;Support</a>
         &nbsp;&nbsp;|&nbsp;&nbsp;
       <a href="http://www.softwareag.com/corporate/community/default.asp" target="_blank">Community</a>
         &nbsp;&nbsp;|&nbsp;&nbsp;
       <a href="mailto://documentation@softwareag.com" target="_blank">Feedback&nbsp;&nbsp;</a></span></div></body></html>