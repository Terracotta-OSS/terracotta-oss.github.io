<!DOCTYPE html ><html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Cache Events in a Terracotta Cluster</title><link rel="Prev" href="co-clst_running_multiple_listeners_on_separate_nodes.html" title="Previous"><link rel="Next" href="to-exhr_cache_exception_handlers.html" title="Next"><link rel="StyleSheet" href="css/aaa_bigmem_max_all.css" type="text/css" media="all"><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all"><link rel="StyleSheet" href="css/social.css" type="text/css" media="all"><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all"><!--[if IE 7]><link rel="StyleSheet" href="css/aaa_bigmem_max_all_IE7.css" type="text/css" media="all"><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print"><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if (window === window.top) {
        // Redirect
        //
        redirect_url = "../index.html#page/bigmemory-max-webhelp/co-clst_events_in_terracotta_cluster.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pgKbPfE7FAeJaaO8yxNPCaw" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/bigmemory-max-webhelp/co-clst_events_in_terracotta_cluster.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../bigmemory-max-webhelp/to-title_product_documentation.html#wwconnect_header">Product Documentation</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../bigmemory-max-webhelp/to-title_bigmemory_max_developer_guide.html#wwconnect_header">BigMemory Max Developer Guide</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../bigmemory-max-webhelp/to-clst_cache_event_listeners.html#wwconnect_header">Cache Event Listeners</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_current">Cache Events in a Terracotta Cluster</span></div><div class="ww_skin_page_toolbar"></div></header><div id="ww3_17_8_33_16_1" class="Heading_3">Cache Events in a Terracotta Cluster</div><div id="ww3_17_8_33_16_3_2" class="Body">Cache events are fired for certain cache operations:</div><div id="ww3_17_8_33_16_3_4_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="inlinetitle">Evictions</span> – An eviction on a client generates an eviction event on that client. An eviction on a Terracotta server fires an event on a random client.</div><div id="ww3_17_8_33_16_3_4_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="inlinetitle">Puts</span> – A put() on a client generates a put event on that client.</div><div id="ww3_17_8_33_16_3_4_6" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="inlinetitle">Updates</span> – If a cache uses fast restart, then an update on a client generates a put event on that client.</div><div id="ww3_17_8_33_16_3_4_8" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="inlinetitle">Orphan eviction</span> – An orphan is an element that exists only on the Terracotta Server Array. If an orphan is evicted, an eviction event is fired on a random client.</div><div id="ww3_17_8_33_16_3_6" class="Body">For information about configuring the scope of cache events in a Terracotta cluster, see "Defining a Distributed Configuration" in the <span class="Citation">Configuration Guide</span> for BigMemory Max.</div><div id="ww3_17_8_33_16_3_8_2" class="Section_Title">Handling Cache Update Events</div><div id="ww3_17_8_33_16_3_8_4" class="Body">Caches generate put events whenever elements are put or updated. If it is important for your application to distinguish between puts and updates, check for the existence of the element during put() operations:</div><div id="ww3_17_8_33_16_3_8_6" class="Preformatted">if (cache.containsKey(key)) { <br>  cache.put(element); <br>  // Action in the event handler on replace. <br>} else { <br>  cache.put(element); <br>  // Action in the event handler on new puts. <br>}</div><div id="ww3_17_8_33_16_3_8_8" class="Body">To protect against races, wrap the if block with explicit locks (see <span class="heading-page"><a href="../bigmemory-max-webhelp/to-lock_using_explicit_locking.html#wwconnect_header" title="Using Explicit Locking">Using Explicit Locking</a></span>). You can also use the atomic cache methods putIfAbsent() or to check for the existence of an element:</div><div id="ww3_17_8_33_16_3_8_10" class="Preformatted">// Returns null if successful or returns the existing (old) element. <br>if((olde = cache.putIfAbsent(element)) == null) { <br>  <br>  // Action in the event handler on new puts. <br>} else { <br>  cache.replace(old, newElement); // Returns true if successful. <br>  // Action in the event handler on replace. <br>}</div><div id="ww3_17_8_33_16_3_8_12" class="Body">If your code cannot use these approaches (or a similar workaround), you can force update events for cache updates by setting the Terracotta property <span class="codeph">ehcache.clusteredStore.checkContainsKeyOnPut</span> at the top of the Terracotta configuration file (tc-config.xml by default) before starting the Terracotta Server Array:</div><div id="ww3_17_8_33_16_3_8_14" class="Preformatted">&lt;tc-properties&gt; <br> &lt;property name="ehcache.clusteredStore.checkContainsKeyOnPut" value="true" /&gt; <br>&lt;/tc-properties&gt;</div><div class="ww_skin_page_overflow"><table class="note1" summary=""><tr><td class="Table_Cell" style="padding-right: 6px; vertical-align: top"><div id="ww3_17_8_33_16_3_8_16_1_3_1_1_1" class="important"><span style="font-weight: bold">Important:  </span>&nbsp;</div></td><td class="Table_Cell" style="padding-right: 6px; vertical-align: top"><div id="ww3_17_8_33_16_3_8_16_1_3_1_2" class="Table_Cell">Enabling this property can substantially degrade performance.</div></td></tr></table></div><footer><!-- Related Topics --><!--                --><!-- Back to Top --><!--             --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br></footer><div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 11px; margin-top: 20px; margin-bottom: 20px;"><span class="xref"><a href="http://documentation.softwareag.com/legal/" target="external_window">Copyright © <span>2010</span><span>-2016</span><span></span><span></span> Software AG, Darmstadt, Germany</a></span>.</div><hr></div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 13px; font-weight: bold; margin-top: 20px;"><span><img style="vertical-align:middle" src="../connect/terracotta_online.png" alt="Product Logo"><a href="https://empower.softwareag.com/ContactSupport/default.asp" target="_blank">Contact&nbsp;Support</a>
         &nbsp;&nbsp;|&nbsp;&nbsp;
       <a href="http://www.softwareag.com/corporate/community/default.asp" target="_blank">Community</a>
         &nbsp;&nbsp;|&nbsp;&nbsp;
       <a href="mailto://documentation@softwareag.com" target="_blank">Feedback&nbsp;&nbsp;</a></span></div></body></html>