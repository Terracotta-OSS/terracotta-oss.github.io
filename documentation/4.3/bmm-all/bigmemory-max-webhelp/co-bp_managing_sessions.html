<!DOCTYPE html ><html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Manage Sessions in a Cluster</title><link rel="Prev" href="co-bp_common_causes_of_failure.html" title="Previous"><link rel="Next" href="co-bp_safe_failover_procedure.html" title="Next"><link rel="StyleSheet" href="css/aaa_bigmem_max_all.css" type="text/css" media="all"><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all"><link rel="StyleSheet" href="css/social.css" type="text/css" media="all"><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all"><!--[if IE 7]><link rel="StyleSheet" href="css/aaa_bigmem_max_all_IE7.css" type="text/css" media="all"><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print"><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if (window === window.top) {
        // Redirect
        //
        redirect_url = "../index.html#page/bigmemory-max-webhelp/co-bp_managing_sessions.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pN9_002fMGJRVJnOrNuZR3SHjzVg" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/bigmemory-max-webhelp/co-bp_managing_sessions.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../bigmemory-max-webhelp/to-title_bigmemory_max_best_practices.html#wwconnect_header">BigMemory Max Best Practices</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_current">Manage Sessions in a Cluster</span></div><div class="ww_skin_page_toolbar"></div></header><div id="ww3_23_12_1" class="Heading_1">Manage Sessions in a Cluster</div><div id="ww3_23_12_2_2_2_3" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Make sure the configured time zone and system time is consistent between all application servers. If they are different a session may appear expired when accessed on different nodes.</div><div id="ww3_23_12_2_2_4_3" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Set <span class="codeph">-Dcom.tc.session.debug.sessions=true</span> and <span class="codeph">-Dcom.tc.session.debug.invalidate=true</span> to generate more debugging information in the client logs.</div><div id="ww3_23_12_2_2_6_3" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>All clustered session implementations (including Terracotta Sessions) require a mutated session object be put back into the session after it's mutated. If the call is missing, then the change isn't known to the cluster, only to the local node. For example:</div><div id="ww3_23_12_2_2_6_5" class="Preformatted_1"> Session session = request.getSession(); <br> Map m  = session.getAttribute("foo"); <br> m.clear(); <br> session.setAttribute("foo", m); // Without this call, the clear() is not effective across the cluster.</div><div id="ww3_23_12_2_4" class="Body">Without a <span class="codeph">setAttribute()</span> call, the session becomes inconsistent across the cluster. Sticky sessions can mask this issue, but as soon as the session is accessed on another node, its state does not match the expected one. To view the inconsistency on a single client node, add the Terracotta property <span class="codeph">-Dcom.tc.session.clear.on.access=true</span> to force locally cached sessions to be cleared with every access.</div><div id="ww3_23_12_2_6" class="Body">If third-party code cannot be refactored to fix this problem, and you are running Terracotta 3.6.0 or higher, you can write a servlet filter that calls <span class="codeph">setAttribute()</span> at the end of every request. Note that this solution may substantially degrade performance.</div><div id="ww3_23_12_2_8" class="Preformatted">    package controller.filter; <br>    <br>    import java.io.IOException; <br>    import java.util.Enumeration; <br>    <br>    import javax.servlet.Filter; <br>    import javax.servlet.FilterChain; <br>    import javax.servlet.FilterConfig; <br>    import javax.servlet.ServletException; <br>    import javax.servlet.ServletRequest; <br>    import javax.servlet.ServletResponse; <br>    import javax.servlet.http.HttpServletRequest; <br>    import javax.servlet.http.HttpSession; <br>    <br>    public class IterateFilter implements Filter { <br>      <br>      public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) <br>      throws IOException, ServletException { <br>        HttpSession session = ((HttpServletRequest) request).getSession(); <br>        if (session != null) { <br>          @SuppressWarnings("rawtypes") <br>          Enumeration e = session.getAttributeNames(); <br>          while (e.hasMoreElements()) { <br>            String name = (String)e.nextElement(); <br>            Object value = session.getAttribute(name); <br>            session.setAttribute(name, value); <br>          } <br>        } <br>      } <br>    <br>      public void init(FilterConfig filterConfig) throws ServletException { <br>        // TODO Auto-generated method stub <br>      } <br>    <br>      public void destroy() { <br>        // TODO Auto-generated method stub <br>      } <br>    }</div><footer><!-- Related Topics --><!--                --><!-- Back to Top --><!--             --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br></footer><div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 11px; margin-top: 20px; margin-bottom: 20px;"><span class="xref"><a href="http://documentation.softwareag.com/legal/" target="external_window">Copyright Â© <span>2010</span><span>-2016</span><span></span><span></span> Software AG, Darmstadt, Germany</a></span>.</div><hr></div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 13px; font-weight: bold; margin-top: 20px;"><span><img style="vertical-align:middle" src="../connect/terracotta_online.png" alt="Product Logo"><a href="https://empower.softwareag.com/ContactSupport/default.asp" target="_blank">Contact&nbsp;Support</a>
         &nbsp;&nbsp;|&nbsp;&nbsp;
       <a href="http://www.softwareag.com/corporate/community/default.asp" target="_blank">Community</a>
         &nbsp;&nbsp;|&nbsp;&nbsp;
       <a href="mailto://documentation@softwareag.com" target="_blank">Feedback&nbsp;&nbsp;</a></span></div></body></html>