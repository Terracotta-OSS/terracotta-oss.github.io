<!DOCTYPE html ><html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Tuning Heap Memory Performance</title><link rel="Prev" href="co-bp_tuning_off_heap_store_performance.html" title="Previous"><link rel="Next" href="co-bp_common_causes_of_failure.html" title="Next"><link rel="StyleSheet" href="css/aaa_bigmem_max_all.css" type="text/css" media="all"><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all"><link rel="StyleSheet" href="css/social.css" type="text/css" media="all"><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all"><!--[if IE 7]><link rel="StyleSheet" href="css/aaa_bigmem_max_all_IE7.css" type="text/css" media="all"><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print"><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if (window === window.top) {
        // Redirect
        //
        redirect_url = "../index.html#page/bigmemory-max-webhelp/co-bp_tuning_heap_memory_performance.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pxgpBNNckgRGiimpyAs4w5Q" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/bigmemory-max-webhelp/co-bp_tuning_heap_memory_performance.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../bigmemory-max-webhelp/to-title_bigmemory_max_best_practices.html#wwconnect_header">BigMemory Max Best Practices</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_current">Tuning Heap Memory Performance</span></div><div class="ww_skin_page_toolbar"></div></header><div id="ww3_23_8_1" class="Heading_1">Tuning Heap Memory Performance</div><div id="ww3_23_8_2_2" class="Body">Long garbage collection (GC) cycles are one of the most common causes of issues in a Terracotta cluster because a full GC event pauses all threads in the JVM. Servers disconnecting clients, clients dropping servers, and timed-out processes are just some of the problems long GC cycles can cause. Having a clear understanding of how your application behaves with respect to creating garbage, and how that garbage is being collected, is necessary for avoiding or solving these issues.</div><div id="ww3_23_8_2_4_2" class="Section_Title">Printing and Analyzing GC Logs</div><div id="ww3_23_8_2_4_4" class="Body">The most effective way to gain that understanding is to create a profile of GC in your application by using tools made for that purpose. Consider using JVM options to generate logs of GC activity:</div><div id="ww3_23_8_2_4_6_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="codeph">-verbose:gc</span></div><div id="ww3_23_8_2_4_6_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="codeph">-Xloggc:&lt;filename&gt;</span></div><div id="ww3_23_8_2_4_6_6" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="codeph">-XX:+PrintGCDetails</span></div><div id="ww3_23_8_2_4_6_8" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="codeph">-XX:+PrintGCTimeStamps</span></div><div id="ww3_23_8_2_4_8" class="Body">Apply an appropriate parsing and visualization tool to GC log files to help analyze their contents.</div><div id="ww3_23_8_2_6_2" class="Section_Title">Observing GC Statistics With jstat</div><div id="ww3_23_8_2_6_4" class="Body">One way to observe GC statistics is by using the Java utility jstat. The following command will produce a log of GC statistics, updated every ten seconds:</div><div id="ww3_23_8_2_6_6" class="Preformatted">jstat -gcutil &lt;pid&gt; 10 1000000</div><div id="ww3_23_8_2_6_8" class="Body">An important statistic is the Full Garbage Collection Time. The difference between the total time for each reading is the amount of time the system was paused. A jump of more than a few seconds will not be acceptable in most application contexts.</div><div id="ww3_23_8_2_8_2" class="Section_Title">Solutions to Problematic GC</div><div id="ww3_23_8_2_8_4" class="Body">Once your application's typical GC cycles are understood, consider one or more of the following solutions:</div><div id="ww3_23_8_2_8_6_2_3" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Maximizing BigMemory to eliminate the drag GC imposes on performance in large heaps.</div><div id="ww3_23_8_2_8_6_2_5" class="List_1_Continued">BigMemory opens up off-heap memory for use by Java applications, and off-heap memory is not subject to GC.</div><div id="ww3_23_8_2_8_6_4_3" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Configuring the <span class="xref"><a href="../bigmemory-max-webhelp/to-hc_configuring_healthchecker_properties.html#wwconnect_header" title="Configuring the HealthChecker Properties">HealthChecker parameters</a></span> in the Terracotta cluster to account for the observed GC cycles.</div><div id="ww3_23_8_2_8_6_4_5" class="List_1_Continued">Increase nodes' tolerance of inactivity in other nodes due to GC cycles.</div><div id="ww3_23_8_2_8_6_6_3" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Tuning the GC parameters to change the way GC runs in the heap.</div><div id="ww3_23_8_2_8_6_6_5" class="List_1_Continued">If running multi-core machines and no collector is specifically configured, consider <span class="codeph">-XX:+UseParallelGC</span> and <span class="codeph">-XX:+UseParallelOldGC</span>.</div><div id="ww3_23_8_2_8_6_6_7" class="List_1_Continued">If running multiple JVMs or application processes on the same machine, tune the number of concurrent threads in the parallel collector with <span class="codeph">-XX:ParallelGCThreads=&lt;number&gt;</span>.</div><div id="ww3_23_8_2_8_6_6_9" class="List_1_Continued">Another collector is called Concurrent Mark Sweep (CMS). This collector is normally not recommended (especially for Terracotta servers) due to certain performance and operational issues it raises. However, under certain circumstances related to the type of hosting platform and application data usage characteristics, it may boost performance and may be worth testing with.</div><div id="ww3_23_8_2_8_6_8_3" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>If running on a 64-bit JVM, and if your JDK supports it, use <span class="codeph">-XX:+UseCompressedOops</span>.</div><div id="ww3_23_8_2_8_6_8_5" class="List_1_Continued">This setting can reduce substantially the memory footprint of object pointer used by the JVM.</div><div id="ww3_23_8_2_8_6_10" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Refactoring clustered applications that unnecessarily create too much garbage.</div><div id="ww3_23_8_2_8_6_12_3" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Ensuring that the problem node has enough memory allocated to the heap.</div><footer><!-- Related Topics --><!--                --><!-- Back to Top --><!--             --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br></footer><div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 11px; margin-top: 20px; margin-bottom: 20px;"><span class="xref"><a href="http://documentation.softwareag.com/legal/" target="external_window">Copyright Â© <span>2010</span><span>-2016</span><span></span><span></span> Software AG, Darmstadt, Germany</a></span>.</div><hr></div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 13px; font-weight: bold; margin-top: 20px;"><span><img style="vertical-align:middle" src="../connect/terracotta_online.png" alt="Product Logo"><a href="https://empower.softwareag.com/ContactSupport/default.asp" target="_blank">Contact&nbsp;Support</a>
         &nbsp;&nbsp;|&nbsp;&nbsp;
       <a href="http://www.softwareag.com/corporate/community/default.asp" target="_blank">Community</a>
         &nbsp;&nbsp;|&nbsp;&nbsp;
       <a href="mailto://documentation@softwareag.com" target="_blank">Feedback&nbsp;&nbsp;</a></span></div></body></html>