<!DOCTYPE html ><html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Using the .NET Client API</title><link rel="Prev" href="co-dot_accessing_data.html" title="Previous"><link rel="Next" href="co-dot_consistency.html" title="Next"><link rel="StyleSheet" href="css/aaa_bigmem_max_all.css" type="text/css" media="all"><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all"><link rel="StyleSheet" href="css/social.css" type="text/css" media="all"><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all"><!--[if IE 7]><link rel="StyleSheet" href="css/aaa_bigmem_max_all_IE7.css" type="text/css" media="all"><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print"><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if (window === window.top) {
        // Redirect
        //
        redirect_url = "../index.html#page/bigmemory-max-webhelp/co-dot_using_dot_net_client_api.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pPwaKAL9UcDSGimWCw4qd0Q" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/bigmemory-max-webhelp/co-dot_using_dot_net_client_api.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../bigmemory-max-webhelp/to-title_component_documentation.html#wwconnect_header">Component Documentation</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../bigmemory-max-webhelp/to-title_ccl_user_guide.html#wwconnect_header">Cross-Language Clients User Guide</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../bigmemory-max-webhelp/to-dot_dot_net_clients.html#wwconnect_header">BigMemory .NET Client</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_current">Using the .NET Client API</span></div><div class="ww_skin_page_toolbar"></div></header><div id="ww3_21_12_9_14_1" class="Heading_3">Using the .NET Client API</div><div id="ww3_21_12_9_14_3_2_2" class="Body">This section covers connecting to, working with, and searching your BigMemory data. For the complete class library documentation, refer to the API documentation in the <span class="filepath">/apis/csharp/apidoc-csharp.zip</span> directory of the kit.</div><div id="ww3_21_12_9_14_3_4_2" class="Section_Title">Connecting with the CL Connector</div><div id="ww3_21_12_9_14_3_4_4" class="Body">Your application will communicate with the CL Connector via the ICacheManager interface.</div><div id="ww3_21_12_9_14_3_4_6" class="Body">Begin by creating a Configuration object. For a deployment where the BigMemory Client is located on the same machine as the CL Connector, use a configuration with the Nirvana Shared Memory (SHM) transport:</div><div id="ww3_21_12_9_14_3_4_8" class="Preformatted">Configuration cfg=new Configuration("/dev/shm", 16));</div><div id="ww3_21_12_9_14_3_4_10" class="Body">For a deployment where the BigMemory Client and the CL Connector are located on different machines, use a configuration with the Nirvana socket transport. For example, here we create a configuration that connects to the local host at the default port, uses Nirvana socket transport, and provisions a pool of 16 connections to share:</div><div id="ww3_21_12_9_14_3_4_12" class="Preformatted">Configuration cfg=new Configuration("localhost",<br>      Constants.defaultPort, TransportType.NIRVANA, 16);</div><div id="ww3_21_12_9_14_3_4_14" class="Body">Notice that configurations with different transport types require different parameters:</div><div id="ww3_21_12_9_14_3_4_16_2_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="inlinetitle">Nirvana Shared Memory (SHM)</span> - <span class="parmname">Configuration("SHMLocation", clientPoolSize)</span> - generally used when the BigMemory Client is located on the same machine as the CL Connector.</div><div id="ww3_21_12_9_14_3_4_16_2_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="inlinetitle">Nirvana socket</span> - <span class="parmname">Configuration("hostName", portNumber, TransportType.NIRVANA, clientPoolSize)</span> - used when the CL Connector and the BigMemory Client are located on different machines.</div><div id="ww3_21_12_9_14_3_4_18" class="Body">Once you have your Configuration instance ready, create an ICacheManager using the <span class="apiname">Xplatform.CreateCacheManager</span> static method:</div><div id="ww3_21_12_9_14_3_4_20" class="Preformatted">ICacheManager cachemanager = XPlatform.CreateCacheManager(cfg);</div><div id="ww3_21_12_9_14_3_4_21" class="Section_Division">Shutting the connection down</div><div id="ww3_21_12_9_14_3_4_21_2" class="Body">The ICacheManager needs to be closed in order for it to release all resources (like connections). Close it by invoking the Close() method on it:</div><div id="ww3_21_12_9_14_3_4_21_4" class="Preformatted">cachemanager.Close();</div><div id="ww3_21_12_9_14_3_6_2" class="Section_Title">Accessing a Cache</div><div id="ww3_21_12_9_14_3_6_4" class="Body">Once you've obtained a reference to your ICacheManager, it is now connected to your CL Connector and will let you access any Cache known by the CL Connector.</div><div id="ww3_21_12_9_14_3_6_6" class="Body">To retrieve a thread-safe instance of a Cache, you will need its name, the type of the key, the value, and a serializer for those types.</div><div id="ww3_21_12_9_14_3_6_7" class="Section_Division">Serializers</div><div id="ww3_21_12_9_14_3_6_7_2" class="Body">The protocol recognizes the following types:</div><div id="ww3_21_12_9_14_3_6_7_4_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>bool: A boolean value (true or false), one byte</div><div id="ww3_21_12_9_14_3_6_7_4_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>byte: A signed byte</div><div id="ww3_21_12_9_14_3_6_7_4_6" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>i16: A 16-bit signed integer</div><div id="ww3_21_12_9_14_3_6_7_4_8" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>i32: A 32-bit signed integer</div><div id="ww3_21_12_9_14_3_6_7_4_10" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>i64: A 64-bit signed integer</div><div id="ww3_21_12_9_14_3_6_7_4_12" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>double: A 64-bit floating point number</div><div id="ww3_21_12_9_14_3_6_7_4_14" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>byte[]: An array of bytes</div><div id="ww3_21_12_9_14_3_6_7_4_16" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>string: Encoding agnostic text or binary string</div><div id="ww3_21_12_9_14_3_6_7_6" class="Body">If you want to send complex types to the CL Connector, you will have to provide a serializer that can serialize your complex key and value types for a Cache.</div><div id="ww3_21_12_9_14_3_6_7_8" class="Body">Say we have the following Class, which is our Value type:</div><div id="ww3_21_12_9_14_3_6_7_10" class="Preformatted">public class User <br>{ <br>    public long Id { get; set; } <br>    public string Login { get; set; } <br>    public string Email { get; set; } <br>}</div><div id="ww3_21_12_9_14_3_6_7_12" class="Body">We store these keyed to the login, as a string. We now need to provide a serializer like this:</div><div id="ww3_21_12_9_14_3_6_7_14" class="Preformatted">public class UserCacheSerializer : ICacheSerializer&lt;string,User&gt;<br> {<br><br>    public Value SerializeKey(string key)<br>    {<br>        Value v = new Value();<br>        v.StringValue = key;<br>        return v;<br>    }<br><br>    public string DeserializeKey(Value serializedKey)<br>    {<br>        return serializedKey.StringValue;<br>    }<br><br>    public StoredValue SerializeValue(User objectValue)<br>    {<br>        Dictionary&lt;String, Value&gt; nvpairs = new Dictionary&lt;string, Value&gt;();<br><br>        Value idval = ValueHelper.NewValue(objectValue.Id);<br>        nvpairs["id"] = idval;<br><br>        Value emailval = ValueHelper.NewValue(objectValue.Email);<br>        nvpairs["email"] = emailval;<br><br>        StoredValue sv = new StoredValue();<br>        sv.Value = ValueHelper.NewValue(Encoding.Unicode.GetBytes(objectValue.Login));<br>        sv.Nvpairs = nvpairs;<br>        return sv;<br><br>    }<br><br>    public User DeserializeValue(StoredValue serializedValue)<br>    {<br>        User user = new User();<br>        user.Login = Encoding.Unicode.GetString(serializedValue.Value.BinaryValue);<br>        user.Id = serializedValue.Nvpairs["id"].LongValue;<br>        user.Email = serializedValue.Nvpairs["email"].StringValue;<br>        return user;<br>    }<br>}</div><div id="ww3_21_12_9_14_3_6_7_16" class="Body">Note that both serialize and deserialize methods (whether for key or value) are kept symmetric.</div><div id="ww3_21_12_9_14_3_6_7_18" class="Body">StoredValue is composed of the actual Value (in this example, the byte array representation of the user's login). StoredValue can hold entire object graphs serialized with whatever serialization strategies fits your needs. It also holds an arbitrary amount of name/value pairs. The names are String, while the values are of type Value. You can use these name-value pairs to store whatever you want. Note that these name-value pairs also become indexable and searchable using the search API.</div><div id="ww3_21_12_9_14_3_6_7_20" class="Body">A byte array is not indexable, however it can be used within name-value pairs. In the above example, both user id and email are stored as byte arrays. Even though byte arrays are not indexable, search can be enabled on the attributes. Since we use the login as the key in our use case, storing that as a binary representation within the "default unindexed value" is good enough.</div><div id="ww3_21_12_9_14_3_6_8" class="Section_Division">Special handling for DateTime objects</div><div id="ww3_21_12_9_14_3_6_8_2" class="Body">C# captures date information with more precision than Java does, which means the string representation has parts that Java is not prepared to parse. There are two parts to handling this. First, use the <span class="apiname">IsoDateTimeConverter</span> for the C# side serialization and deserialization code. Second, trim C# DateTime objects to millisecond granularity. You can do this via the <span class="apiname">Terracotta.Ehcache.Utilities.DateUtility.TrimToMillisGranularity(DateTime dt)</span> method. It returns a new DateTime object trimmed appropriately. Alternatively, you can use <span class="apiname">ValueHelper.newValue(..)</span> on a DateTime object to do the trimming for you.</div><div id="ww3_21_12_9_14_3_6_9" class="Section_Division">Key-based store and retrieve</div><div id="ww3_21_12_9_14_3_6_9_2" class="Body">Now that we have defined an ICacheSerializer for our cache, we can retrieve the cache from the ICacheManager. The example below assumes that we have defined a cache named "userCache" within the ehcache.xml file used to configure the CL Connector.</div><div id="ww3_21_12_9_14_3_6_9_4" class="Preformatted">// create a serializer<br>ICacheSerializer&lt;string, User&gt; serializer = new UserCacheSerializer();<br><br>// get a cache <br>ICache&lt;string, User&gt; users = cachemanager.GetCache("userCache", serializer);<br><br>// make a user<br>User user1 = new User();<br>user1.Id = 1;<br>user1.Email = "someone@somewhere";<br>user1.Login = "secretpasswd";<br><br>// put the user<br>users.Put(user1.Login, user1, ConsistencyType.STRONG);</div><div id="ww3_21_12_9_14_3_6_9_6" class="Body">The following is an example if you were using the BSON code sample for .NET (Recipe2 is the class defining the domain object, and Recipe2BsonSerializer() is the serializer class).</div><div id="ww3_21_12_9_14_3_6_9_8" class="Preformatted">ICache&lt;string, Recipe2&gt; cache = cacheManager.GetCache("TestCache", <br>    new Recipe2BsonSerializer());<br>cache.Put(rec.Name, rec, ConsistencyType.STRONG);</div><div id="ww3_21_12_9_14_3_6_9_10" class="Body">The <span class="codeph">ConsistencyType</span> attribute sets the consistency, strong or eventual, with which you expect the CL Connector to execute an operation. For more information, refer to <span class="xref"><a href="../bigmemory-max-webhelp/co-cpp_consistency.html#wwconnect_header" title="Consistency">Consistency</a></span>.</div><div id="ww3_21_12_9_14_3_6_9_12" class="Body">To retrieve by key, invoke the get method:</div><div id="ww3_21_12_9_14_3_6_9_14" class="Preformatted">User someUser = userCache.Get(someLogin, ConsistencyType.EVENTUAL);</div><div id="ww3_21_12_9_14_3_6_9_16" class="Body">To retrieve in C#:</div><div id="ww3_21_12_9_14_3_6_9_18" class="Preformatted">Recipe2 rec = (Recipe2)cache.Get(args[1], ConsistencyType.EVENTUAL);</div><div id="ww3_21_12_9_14_3_8_2" class="Section_Title">Compare and Swap (CAS) Operations</div><div id="ww3_21_12_9_14_3_8_4" class="Body">The following CAS operations are provided in C#:</div><div id="ww3_21_12_9_14_3_8_6_2_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="apiname">PutIfAbsent(TKey, TValue)</span> - Puts the specified key/value pair into the cache only if the key has no currently assigned value. Unlike Put, which can replace an existing key/value pair, <span class="apiname">PutIfAbsent</span> creates the key/value pair only if it is not present in the cache.</div><div id="ww3_21_12_9_14_3_8_6_2_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="apiname">Remove(TKey, TValue)</span> - Conditionally removes the specified key, if it is mapped to the specified value.</div><div id="ww3_21_12_9_14_3_8_6_2_6" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="apiname">Replace(TKey, TValue)</span> - Maps the specified key to the specified value, if the key is currently mapped to some value.</div><div id="ww3_21_12_9_14_3_8_6_2_8" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="apiname">Replace(TKey, OldValue, NewValue)</span> - Conditionally replaces the specified key's old value with the new value, if the currently existing value matches the old value.</div><div id="ww3_21_12_9_14_3_8_8" class="Body">For more information about atomic operations and cache consistency, refer to <span class="xref"><a href="../bigmemory-max-webhelp/co-cpp_consistency.html#wwconnect_header" title="Consistency">Consistency</a></span>.</div><div id="ww3_21_12_9_14_3_10_2" class="Section_Title">Search</div><div id="ww3_21_12_9_14_3_10_4" class="Body">This section provides an overview of how to do cross-language searches of PNF data stored within BigMemory. More detailed information may be found on the <span class="Citation">BigMemory Max Developer Guide</span>. </div><div id="ww3_21_12_9_14_3_10_6" class="Body">In order to search BigMemory data, you first need to add the <span class="codeph">&lt;searchable/&gt;</span> tag to the cache configuration in your <span class="filepath">ehcache.xml</span> file.</div><div id="ww3_21_12_9_14_3_10_8" class="Preformatted">&lt;ehcache&gt;<br>(...)<br>  &lt;cache name="userCache"&gt;<br>  (...)<br>    &lt;searchable/&gt;<br>  &lt;/cache&gt;<br>&lt;/ehcache&gt;</div><div id="ww3_21_12_9_14_3_10_10" class="Body">This configuration will scan all keys and values in the cache and, if they are of supported search types, add them as search attributes. Values of the Name/Value pairs in the PNF's StoredValue sent to the CL Connector, other than of type byte[], can all be indexed and made searchable. (Continuing with the example of the previous section, this would mean <span class="codeph">id</span> and <span class="codeph">email</span>.)</div><div id="ww3_21_12_9_14_3_10_12" class="Body">You can also add search attributes using the provided attributeExtractor class, for example:</div><div id="ww3_21_12_9_14_3_10_14" class="Preformatted">&lt;ehcache&gt;<br>(...)<br>  &lt;cache name="userCache"&gt;<br>  (...)<br>    &lt;searchable&gt;<br>      &lt;searchAttribute name="email" class="net.sf.ehcache.xplatform.search.Indexer"/&gt;<br>    &lt;/searchable&gt;<br>  &lt;/cache&gt;<br>&lt;/ehcache&gt;</div><div id="ww3_21_12_9_14_3_10_16" class="Body">To perform a query, use the Cache.query(String) method, providing a BigMemory SQL query string, for example:</div><div id="ww3_21_12_9_14_3_10_18" class="Preformatted">SearchResults&lt;string, User&gt; result = userCache.Query("select * from userCache <br>    where email ilike '%@terracottatech.com'");</div><div id="ww3_21_12_9_14_3_10_20" class="Body">For more information about how to construct BigMemory SQL queries, see "Searching with BigMemory SQL" in the <span class="Citation">BigMemory Max Developer Guide</span>.</div><div class="ww_skin_page_overflow"><table class="note1" summary=""><tr><td class="Table_Cell" style="padding-right: 6px; vertical-align: top"><div id="ww3_21_12_9_14_3_10_22_1_3_1_1_1" class="Note"><span style="font-weight: bold">Note:  </span>&nbsp;</div></td><td class="Table_Cell" style="padding-right: 6px; vertical-align: top"><div id="ww3_21_12_9_14_3_10_22_1_3_1_2" class="Table_Cell">Note: Java (POJO) data stored within BigMemory can also be searched using the native Ehcache Search API, which is documented on the <span class="Citation">BigMemory Max Developer Guide</span>.</div></td></tr></table></div><footer><!-- Related Topics --><!--                --><!-- Back to Top --><!--             --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br></footer><div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 11px; margin-top: 20px; margin-bottom: 20px;"><span class="xref"><a href="http://documentation.softwareag.com/legal/" target="external_window">Copyright © <span>2010</span><span>-2016</span><span></span><span></span> Software AG, Darmstadt, Germany</a></span>.</div><hr></div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 13px; font-weight: bold; margin-top: 20px;"><span><img style="vertical-align:middle" src="../connect/terracotta_online.png" alt="Product Logo"><a href="https://empower.softwareag.com/ContactSupport/default.asp" target="_blank">Contact&nbsp;Support</a>
         &nbsp;&nbsp;|&nbsp;&nbsp;
       <a href="http://www.softwareag.com/corporate/community/default.asp" target="_blank">Community</a>
         &nbsp;&nbsp;|&nbsp;&nbsp;
       <a href="mailto://documentation@softwareag.com" target="_blank">Feedback&nbsp;&nbsp;</a></span></div></body></html>