<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

  <link rel="shortcut icon"  type="image/x-icon" href="/images/favicon.ico">
  <link rel="icon" type="image/x-icon" href="/images/favicon.ico">

  <title>Terracotta</title>

  <meta name="description" content="Java's most widely used cache.">

  <link rel="canonical" href="http://www.terracotta.org/documentation/4.1/bigmemorymax/code-samples.html">
  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Terracotta Feed">


  <!-- Fonts -->
  <link href='https://fonts.googleapis.com/css?family=Lato:300,400,300italic,400italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>

  <!-- Global CSS -->

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.5/spacelab/bootstrap.min.css">


<!--
  <link rel="stylesheet" href="/plugins/highlight/styles/idea.css">
  <script src="/plugins/highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
-->

  <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
  <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/prettify.css"></script>

  <link rel="stylesheet" href="/css/main.css">

<!--
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
  <script>document.addEventListener('DOMContentLoaded', prettyPrint)</script>
-->

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

</head>


  <body>

    

    <!-- Fixed navbar -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="site-title" href="/"><img src="/images/Terracotta_Logo_sm.png" style="margin-top:12px;margin-bottom:6px;"/></a>
          <span style="vertical-align:bottom;color:gray;">By</span>
          <a class="SAG-Logo" href="http://www.softwareag.com/corporate/products/terracotta"><img src="/images/SAG_Logo.png" style="margin-top:12px;margin-bottom:6px;height:1.5em;width:9em;"/></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li id="tc_mnu_about"><a href="/about/"><i class="fa fa-info-circle"></i> About</a></li>
            <li id="tc_mnu_docs"><a href="/documentation/"><i class="fa fa-book"></i> Docs</a></li>
            <li id="tc_mnu_download"><a href="/downloads/"><i class="fa fa-download"></i> Download</a></li>
            <li id="tc_mnu_community" class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><i class="fa fa-users"></i> Community <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li class="dropdown-header">We Love Contributors</li>
                <li><a href="/community/contribute.html"><i class="fa fa-code"></i> Contributing</a></li>
                <li><a href="/resources/"><i class="fa fa-external-link-square"></i> External Resources</a></li>
                <li><a href="/blog" target="_blank"><i class="fa fa-rss-square"></i> Terracotta Blog</a></li>
                <li role="separator" class="divider"></li>
                <li class="dropdown-header">Forums</li>
                <li><a href="https://groups.google.com/forum/#!forum/terracotta-oss" target="_blank"><i class="fa fa-commenting"></i> Users' Forum</a></li>
                <li role="separator" class="divider"></li>
                <li class="dropdown-header">Source Code</li>
                <li><a href="https://github.com/Terracotta-OSS" target="_blank"><i class="fa fa-github"></i> GitHub  Repositories</a></li>
                <li><a href="http://svn.terracotta.org/svn/tc/" target="_blank"><i class="fa fa-code-fork"></i> SVN  (Terracotta 4.x)</a></li>
                <li role="separator" class="divider"></li>
                <li class="dropdown-header">Bug Tracking</li>
                <li><a href="https://github.com/Terracotta-OSS" target="_blank"><i class="fa fa-bug"></i> GitHub  (use respective project)</a></li>
              </ul>
            </li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li id="tc_mnu_events"><a href="/events"><i class="fa fa-calendar"></i> News & Events</a></li>
            <li><a href="/blog"><i class="fa fa-rss-square"></i> Terracotta Blog</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

<br/>
<br/>
<br/>


    <div class="container-fluid">
      <div id="contentTitle">
        <h1></h1>
      </div>
      <div>
        <BR/>
        <br/>

<div class="container-fluid">

  <div class="row row-offcanvas row-offcanvas-left">

    <!-- sidebar -->
    <div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar" role="navigation">
        <ul class="nav">
          <li id="tc_mnu_docs_current" class="submenu"><a href="#current_version">Current Documentation</a></li>
          <li id="tc_mnu_doce_release_notes" class="submenu"><a href="http://www.terracotta.org/confluence/display/release/Home" target="_blank">Release Notes</a></li>
          <li id="tc_mnu_docs_previous" class="submenu"><a href="#historical_versions">Historical Versions</a></li>
        </ul>
    </div>

    <!-- main area -->
    <div class="col-xs-12 col-sm-9">
      <header class="post-header">
        
        <h1 class="post-title"></h1>
        <hr/>
        
      </header>
      <article class="post-content">
        <p>#Code Samples</p>

<table>
  <tbody>
    <tr>
      <td>{toc</td>
      <td>2:2}</td>
    </tr>
  </tbody>
</table>

<p>This page is a companion to the code samples provided in the BigMemory Max kit. For BigMemory tutorials, visit <a href="/documentation/4.1/bigmemorymax/get-started/hello-world">Hello, World!</a></p>

<h2 id="introduction">Introduction</h2>
<p>The following code samples illustrate various features of BigMemory Max. They
are also available in the BigMemory Max kit in the /code-samples directory.</p>

<table>
  <thead>
    <tr>
      <th>Title</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td width="200"><a href="#example01-config-file">example01-config-file</a></td>
      <td>BigMemory may be configured declaratively,
	using an XML configuration file, or programmatically via the fluent
	configuration API. This sample shows how to configure a basic instance
	of BigMemory Max declaratively with the XML configuration file.</td>
    </tr>

    <tr>
      <td><a href="#example02-config-programmatic">example02-config-programmatic</a></td>
      <td>Configure a basic instance of BigMemory Max programmatically with the fluent
	configuration API.</td>
    </tr>

    <tr>
      <td><a href="#example03-crud">example03-crud</a></td>
      <td>Basic create, retrieve, update and delete (CRUD) operations available in
	BigMemory Max.</td>
    </tr>

    <tr>
      <td><a href="#example04-search">example04-search</a></td>
      <td>Basic in-memory search features of BigMemory Max.</td>
    </tr>

    <tr>
      <td><a href="#example05-nonstop">example05-nonstop</a></td>
      <td>
	The nonstop feature allows operations to proceed on clients that have become disconnected from the cluster. The rejoin feature then allows clients to identify a source of Terracotta configuration and rejoin a cluster. This sample demonstrates the nonstop and rejoin features of BigMemory Max.
      </td>
    </tr>
    <tr>
      <td><a href="#example06-arc">example06-arc</a></td>
      <td>
	Automatic Resource Control (ARC) is a powerful capability of BigMemory Max
	that gives users the ability to control how much data is stored in heap memory
	and off-heap memory. This sample shows the basic configuration options for data
	tier sizing using ARC.
      </td>
    </tr>
    <tr>
      <td><a href="#example07-cache">example07-cache</a></td>
      <td>BigMemory Max is a powerful in-memory data
	management solution. Among its many applications, BigMemory Max may be used as a
	cache to speed up access to data from slow or expensive databases and other
	remote data sources. This example shows how to enable and configure the caching
	features available in BigMemory Max.</td>
    </tr>
  </tbody>
</table>

<p>To run the code samples with Maven, you will need to add the Terracotta Maven repositories to your Maven settings.xml file. Add the following repository information to your settings.xml file:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;repository&gt;
    &lt;id&gt;terracotta-repository&lt;/id&gt;
    &lt;url&gt;http://www.terracotta.org/download/reflector/releases&lt;/url&gt;
    &lt;releases&gt;
        &lt;enabled&gt;true&lt;/enabled&gt;
    &lt;/releases&gt;
&lt;/repository&gt;
</code></pre>
</div>

<p>For further information, refer to <a href="http://terracotta.org/documentation/more/apache-maven">Working with Apache Maven</a>.</p>

<p><a id="example01-config-file"></a></p>
<h2 id="example-1-declarative-configuration-via-xml">Example 1: Declarative Configuration via XML</h2>

<p>To configure BigMemory declaratively with an XML file, create a
CacheManager instance, passing the a file name or an URL object to the
constructor.</p>

<p>The following example shows how to create a CacheManager with an URL of the XML
file in the classpath at <code class="highlighter-rouge">/xml/ehcache.xml</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CacheManager manager = CacheManager.newInstance(
                          getClass().getResource("/xml/ehcache.xml"));
try {
  Cache bigMemory = manager.getCache("BigMemory");
  // now do stuff with it...

} finally {
  if (manager != null) manager.shutdown();
}
</code></pre>
</div>

<p>Here are the contents of the XML configuration file used by this sample:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;ehcache xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:noNamespaceSchemaLocation="http://www.ehcache.org/ehcache.xsd"
         name="config"&gt;
  &lt;cache name="BigMemory"
         maxBytesLocalHeap="512M"
         maxBytesLocalOffHeap="32G"
         copyOnRead="true"
         statistics="true"
         eternal="true"&gt;
  &lt;/cache&gt;
&lt;/ehcache&gt;
</code></pre>
</div>

<p>The configuration element <code class="highlighter-rouge">maxBytesLocalOffHeap</code> lets you set how much off-heap
memory to use. BigMemory’s unique off-heap memory storage lets you use all of
the memory available on a server in a single JVM—from gigabytes to
multiple terabytes—without causing garbage
collection pauses.</p>

<p><a id="example02-config-programmatic"></a></p>
<h2 id="example-2-programmatic-configuration">Example 2: Programmatic Configuration</h2>

<p>To configure BigMemory Max programmatically, use the <a href="http://www.ehcache.org/apidocs/2.8.5/index.html">Ehcache fluent
configuration API</a>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Configuration managerConfiguration = new Configuration()
    .name("bigmemory-config")
    .cache(new CacheConfiguration()
        .name("BigMemory")
        .maxBytesLocalHeap(512, MemoryUnit.MEGABYTES)
        .maxBytesLocalOffHeap(1, MemoryUnit.GIGABYTES)
        .copyOnRead(true)
        .statistics(true)
        .eternal(true)
    );

CacheManager manager = CacheManager.create(managerConfiguration);
try {
  Cache bigMemory = manager.getCache("BigMemory");
  // now do stuff with it...

} finally {
  if (manager != null) manager.shutdown();
}
</code></pre>
</div>

<p><a id="example03-crud"></a></p>
<h2 id="example-3-create-read-update-and-delete-crud">Example 3: Create, Read, Update and Delete (CRUD)</h2>
<p>The CRUD sample demonstrates basic create, read, update and delete operations.</p>

<p>First, we create a BigMemory data store configured to use 128 MB of heap memory:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Configuration managerConfiguration = new Configuration();
managerConfiguration.name("config")
    .terracotta(new TerracottaClientConfiguration().url("localhost:9510"))
    .cache(new CacheConfiguration()
        .name("bigMemory-crud")
        .maxBytesLocalHeap(128, MemoryUnit.MEGABYTES)
        .terracotta(new TerracottaConfiguration())
    );

CacheManager manager = CacheManager.create(managerConfiguration);
Cache bigMemory = manager.getCache("bigMemory-crud");
</code></pre>
</div>

<p>Now that we have a BigMemory instance configured and available, we can start
creating data in it:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>final Person timDoe = new Person("Tim Doe", 35, Person.Gender.MALE,
    "eck street", "San Mateo", "CA");
bigMemory.put(new Element("1", timDoe));
</code></pre>
</div>

<p>Then, we can read data from it:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>final Element element = bigMemory.get("1");
System.out.println("The value for key 1 is  " + element.getObjectValue());
</code></pre>
</div>

<p>And update it:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>final Person pamelaJones = new Person("Pamela Jones", 23, Person.Gender.FEMALE,
    "berry st", "Parsippany", "LA");
bigMemory.put(new Element("1", pamelaJones));
final Element updated = bigMemory.get("1");
System.out.println("The value for key 1 is now " + updated.getObjectValue() +
                     ". key 1 has been updated.");
</code></pre>
</div>

<p>And delete it:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>bigMemory.remove("1");
System.out.println("Try to retrieve key 1.");
final Element removed = bigMemory.get("1");
System.out.println("Value for key 1 is " + removed +
                   ". Key 1 has been deleted.");
</code></pre>
</div>

<p>You can also create or update multiple entries at once:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Collection&lt;Element&gt; elements = new ArrayList&lt;Element&gt;();
elements.add(new Element("1", new Person("Jane Doe", 35,
    Person.Gender.FEMALE, "eck street", "San Mateo", "CA")));
elements.add(new Element("2", new Person("Marie Antoinette", 23,
    Person.Gender.FEMALE, "berry st", "Parsippany", "LA")));
elements.add(new Element("3", new Person("John Smith", 25,
    Person.Gender.MALE, "big wig", "Beverly Hills", "NJ")));
elements.add(new Element("4", new Person("Paul Dupont", 25,
    Person.Gender.MALE, "big wig", "Beverly Hills", "NJ")));
elements.add(new Element("5", new Person("Juliet Capulet", 25,
    Person.Gender.FEMALE, "big wig", "Beverly Hills", "NJ")));

bigMemory.putAll(elements);
</code></pre>
</div>

<p>And read multiple entries at once:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>final Map&lt;Object, Element&gt; elementsMap = bigMemory.getAll(
    Arrays.asList("1", "2", "3"));
</code></pre>
</div>

<p>And delete multiple entries at once:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>bigMemory.removeAll(Arrays.asList("1", "2", "3"));
</code></pre>
</div>

<p>And delete everything at once:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>bigMemory.removeAll();
</code></pre>
</div>

<p><a id="example04-search"></a></p>
<h2 id="example-4-search">Example 4: Search</h2>
<p>BigMemory Max comes with powerful in-memory search capabilities. This sample shows
how to perform basic search operations on your in-memory data using the Search API.
You can also issue queries using BigMemory SQL, either from the command line or from the Terracotta Management Console (TMC). This SQL-like language is documented on the <a href="/documentation/4.1/bigmemorymax/search/bigmemory-sql">BigMemory SQL</a> page.</p>

<p>First, create an instance of BigMemory Max with searchable attributes:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Configuration managerConfig = new Configuration()
    .cache(new CacheConfiguration().name("MySearchableDataStore")
        .eternal(true)
        .maxBytesLocalHeap(512, MemoryUnit.MEGABYTES)
        .maxBytesLocalOffHeap(32, MemoryUnit.GIGABYTES)
        .searchable(new Searchable()
            .searchAttribute(new SearchAttribute().name("age"))
            .searchAttribute(new SearchAttribute().name("gender")
                .expression("value.getGender()"))
            .searchAttribute(new SearchAttribute().name("state")
                .expression("value.getAddress().getState()"))
            .searchAttribute(new SearchAttribute().name("name")
                .className(NameAttributeExtractor.class.getName()))
        )
    );

CacheManager manager = CacheManager.create(managerConfig);
Ehcache bigMemory = manager.getEhcache("MySearchableDataStore");
</code></pre>
</div>

<p>Next, insert data:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>bigMemory.put(new Element(1, new Person("Jane Doe", 35, Gender.FEMALE,
    "eck street", "San Mateo", "CA")));
bigMemory.put(new Element(2, new Person("Marie Antoinette", 23, Gender.FEMALE,
    "berry st", "Parsippany", "LA")));
bigMemory.put(new Element(3, new Person("John Smith", 25, Gender.MALE,
    "big wig", "Beverly Hills", "NJ")));
bigMemory.put(new Element(4, new Person("Paul Dupont", 45, Gender.MALE,
    "cool agent", "Madison", "WI")));
bigMemory.put(new Element(5, new Person("Juliet Capulet", 30, Gender.FEMALE,
    "dah man", "Bangladesh", "MN")));
for (int i = 6; i &lt; 1000; i++) {
  bigMemory.put(new Element(i, new Person("Juliet Capulet" + i, 30,
      Person.Gender.MALE, "dah man", "Bangladesh", "NJ")));
}
</code></pre>
</div>

<p>Create some search attributes and construct a query:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Attribute&lt;Integer&gt; age = bigMemory.getSearchAttribute("age");
Attribute&lt;Gender&gt; gender = bigMemory.getSearchAttribute("gender");
Attribute&lt;String&gt; name = bigMemory.getSearchAttribute("name");
Attribute&lt;String&gt; state = bigMemory.getSearchAttribute("state");

Query query = bigMemory.createQuery();
query.includeKeys();
query.includeValues();
query.addCriteria(name.ilike("Jul*").and(gender.eq(Gender.FEMALE)))
    .addOrderBy(age, Direction.ASCENDING).maxResults(10);
</code></pre>
</div>

<p>Execute the query and look at the results:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Results results = query.execute();
System.out.println(" Size: " + results.size());
System.out.println("----Results-----\n");
for (Result result : results.all()) {
  System.out.println("Maxt: Key[" + result.getKey()
                     + "] Value class [" + result.getValue().getClass()
                     + "] Value [" + result.getValue() + "]");
}
</code></pre>
</div>

<p>We can also use Aggregators to perform computations across query
results. Here’s an example that computes the average age of all people in the
data set:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Query averageAgeQuery = bigMemory.createQuery();
averageAgeQuery.includeAggregator(Aggregators.average(age));
System.out.println("Average age: "
                   + averageAgeQuery.execute().all().iterator().next()
                       .getAggregatorResults());
</code></pre>
</div>

<p>We can also restrict the calculation to a subset based on search
attributes. Here’s an example that computes the average age of all people in
the data set between the ages of 30 and 40:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Query agesBetween = bigMemory.createQuery();
agesBetween.addCriteria(age.between(30, 40));
agesBetween.includeAggregator(Aggregators.average(age));
System.out.println("Average age between 30 and 40: "
                   + agesBetween.execute().all().iterator().next()
                       .getAggregatorResults());
</code></pre>
</div>

<p>Using Aggregators, we can also find number of entries that match our search
criteria.  Here’s an example that finds the number of people in the data set
who live in New Jersey:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Query newJerseyCountQuery = bigMemory.createQuery().addCriteria(
                                state.eq("NJ"));
newJerseyCountQuery.includeAggregator(Aggregators.count());
System.out.println("Count of people from NJ: "
                   + newJerseyCountQuery.execute().all().iterator().next()
                       .getAggregatorResults());
</code></pre>
</div>

<p><a id="example05-nonstop"></a></p>
<h2 id="example-5-nonstoprejoin">Example 5: Nonstop/Rejoin</h2>
<p>The nonstop feature allows certain operations to proceed on clients that have become disconnected from the cluster, and it allows operations to proceed even if they cannot complete by the nonstop timeout value. The rejoin feature then allows clients to identify a source of Terracotta configuration, so that clients can rejoin a cluster after having been either disconnected from that cluster or timed out by a Terracotta server.</p>

<p>This example demonstrates the nonstop and rejoin features of BigMemory Max. After loading the configuration below, use the scripts provided to start and run the server. Then stop the server and verify that the nonstop feature is working. Start the server again and watch the rejoin feature in action.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Configuration managerConfig = new Configuration()
    .terracotta(new TerracottaClientConfiguration().url("localhost:9510").rejoin(true))
    .cache(new CacheConfiguration().name("nonstop-sample")
        .persistence(new PersistenceConfiguration().strategy(DISTRIBUTED))
        .maxBytesLocalHeap(128, MemoryUnit.MEGABYTES)
        .maxBytesLocalOffHeap(1, MemoryUnit.GIGABYTES)
        .terracotta(new TerracottaConfiguration()
        .nonstop(new NonstopConfiguration()
        .immediateTimeout(false)
            .timeoutMillis(10000).enabled(true)
        )
        ));

CacheManager manager = CacheManager.create(managerConfig);
Ehcache bigMemory = manager.getEhcache("nonstop-sample");

try {
  System.out.println("**** Put key 1 / value timDoe. ****");
  final Person timDoe = new Person("Tim Doe", 35, Person.Gender.MALE,
      "eck street", "San Mateo", "CA");
  bigMemory.put(new Element("1", timDoe));

  System.out.println("**** Get key 1 / value timDoe. ****");
  System.out.println(bigMemory.get("1"));
  waitForInput();

  System.out
      .println("**** Now you have to kill the server using the
       stop-sample-server.bat on Windows or stop-sample-server.sh otherwise ****");
  try {
    while (true) {
      bigMemory.get("1");
    }
  } catch (NonStopCacheException e) {
    System.out
        .println("**** Server is unreachable - NonStopException received when trying
        to do a get on the server. NonStop is working ****");
  }

  System.out
      .println("**** Now you have to restart the server using the start-sample-server.bat
      on Windows or start-sample-server.sh otherwise ****");

  boolean serverStart = false;
  while (serverStart  == false) {
    try {
      bigMemory.get("1");
      //if server is unreachable, exception is thrown when doing the get
      serverStart = true;
    } catch (NonStopCacheException e) {
    }
  }
  System.out
      .println("**** Server is reachable - No More NonStopException received when
      trying to do a get on the server. Rejoin is working ****");
} finally

{
  if (manager != null) manager.shutdown();
}
</code></pre>
</div>

<p><a id="example06-arc"></a></p>
<h2 id="example-6-automatic-resource-control-arc">Example 6: Automatic Resource Control (ARC)</h2>

<p>Automatic Resource Control (ARC) is a powerful capability of BigMemory Max
that gives users the ability to control how much data is stored in heap memory
and off-heap memory.</p>

<p>The following XML configuration instructs ARC to allocate a maximum of 512 M of heap
memory and 8 G of off-heap memory. In this example, when 512 M of heap memory is used, ARC will
automatically move data into off-heap memory up to a maximum of 8 G.  The
amount of off-heap memory you can use is limited only by the amount of physical
RAM you have available.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;ehcache xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:noNamespaceSchemaLocation="http://ehcache.org/ehcache.xsd"
     updateCheck="false" monitoring="autodetect"
     dynamicConfig="true"
     name="MyManager" maxBytesLocalHeap="512M"
     maxBytesLocalOffHeap="8G"&gt;

  &lt;defaultCache&gt;
  &lt;/defaultCache&gt;

  &lt;cache name="BigMemory1"&gt;
  &lt;/cache&gt;

  &lt;cache name="BigMemory2"&gt;
  &lt;/cache&gt;

&lt;/ehcache&gt;
</code></pre>
</div>

<p>This instructs the ARC capability of BigMemory to keep a maximum of 512 MB of its data in heap
for nanosecond to microsecond access.  In this example, as the 512 MB of heap memory fills up,
ARC will automatically move data to the 8 GB off-heap store where it is
available at microsecond speed. This configuration keeps heap sizes small to
avoid garbage collection pauses and tuning, but still uses large amounts of
in-process memory for ultra-fast access to data.</p>

<p><strong>Important:</strong> <em>BigMemory Max is capable of addressing gigabytes to terabytes of
in-memory data in a single JVM. However, to avoid swapping take care not to configure BigMemory Max to use more memory than is physically available on your hardware.</em></p>

<p>It’s also possible to allocate resources on a per-data set basis.  Here’s
an example of allocating 4 G of off-heap memory to the BigMemory1 data set and
4 G of off-heap memory to the BigMemory2 data set:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;ehcache xmlns
 ...
     name="MyManager"
     maxBytesLocalHeap="512M"
     maxBytesLocalOffHeap="32G"
     maxBytesLocalDisk="128G"&gt;

  &lt;cache name="BigMemory1"
         maxBytesLocalOffHeap="4G"&gt;
  &lt;/cache&gt;

  &lt;cache name="BigMemory2"
         maxBytesLocalOffHeap="4G"&gt;
  &lt;/cache&gt;

&lt;/ehcache&gt;
</code></pre>
</div>

<p><a id="example07-cache"></a></p>
<h2 id="example-7-using-bigmemory-as-a-cache">Example 7: Using BigMemory As a Cache</h2>

<p>BigMemory Max is a powerful in-memory data
management solution. Among its many applications, BigMemory Max may be used as a
cache to speed up access to data from slow or expensive databases and other
remote data sources. This example shows how to enable and configure the caching
features available in BigMemory Max.</p>

<p>The following programmatic configuration snippet shows how to set time-to-live
(TTL) and time-to-idle (TTI) policies on a data set:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Configuration managerConfiguration = new Configuration();
managerConfiguration.name("cacheManagerCompleteExample")
    .terracotta(new TerracottaClientConfiguration().url("localhost:9510"))
    .cache(
        new CacheConfiguration()
            .name("sample-cache")
            .maxBytesLocalHeap(128, MemoryUnit.MEGABYTES)
            .timeToLiveSeconds(4)
            .timeToIdleSeconds(2)
            .terracotta(new TerracottaConfiguration())
    );


CacheManager manager = CacheManager.create(managerConfiguration);
</code></pre>
</div>

<p>The <code class="highlighter-rouge">timeToLiveSeconds</code> directive sets the maximum age of an element in the
data set.  Elements older than the maximum TTL will not be returned from the
data store.  This is useful when BigMemory is used as a cache of external data
and you want to ensure the freshness of the cache.</p>

<p>The <code class="highlighter-rouge">timeToIdleSeconds</code> directive sets the maximum time since last access of an
element. Elements that have been idle longer than the maximum TTI will not be
returned from the data store. This is useful when BigMemory is being used as a
cache of external data and you want to bias the eviction algorithm towards
removing idle entries.</p>

<p>If neither TTL nor TTI are set (or set to zero), data will stay in BigMemory until it is
explicitly removed.</p>

      </article>
    </div>

  </div>

</div>

      </div>
    </div>

    <br/>
<footer class="site-footer">

  <div class="container">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        Related Projects:<br/>
        <a href="http://www.ehcache.org"><img src="/images/ehcache.png" style=""></a><br/><br/>
        <a href="http://www.quartz-scheduler.org"><img src="/images/logo-quartz-scheduler.png" style="max-height: 32px;"></a>

        <!--
        <ul class="contact-list">
          <li>Terracotta</li>
          <li><a href="mailto:tc-oss@softwareag.com">tc-oss@softwareag.com</a></li>
        </ul>
      -->
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/terracotta-oss">
              <i class="fa fa-github"></i> GitHub
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/terracottatech">
              <i class="fa fa-twitter"></i> Twitter
            </a>
          </li>
          

          
          <li>
            <a href="http://www.facebook.com/Terracotta">
              <i class="fa fa-facebook"></i> Facebook
            </a>
          </li>
          

          
          <li>
            <a href="http://www.linkedin.com/company/terracotta">
              <i class="fa fa-linkedin"></i> LinkedIn
            </a>
          </li>
          

          <li>
            <a href="/feed.xml" title="Atom/RSS Feed">
              <i class="fa fa-rss-square"></i> Atom/RSS Feed
            </a>
          </li>
        </ul>
      </div>

    <div class="footer-col  footer-col-3">
      <a href="/downloads/"><i class="fa fa-download"></i> Download Now</a>
      <br/>
      <a href="/documentation/"><i class="fa fa-book"></i> Documentation</a>
      <br/>
      <a href="/resources/"><i class="fa fa-external-link-square"></i> Resources</a>
      <br/>
      <a href="/blog/"><i class="fa fa-rss-square"></i> Terracotat Blog</a>
      <br/>
      <a href="/community/"><i class="fa fa-users"></i> Join the Community</a>
    </div>

    </div>

    <div class="container-fluid">
        <hr/>
        <a class="SAG-Logo" href="http://www.softwareag.com/corporate/products/terracotta"><img src="/images/SAG_Logo.png" style="height:1.5em;width:9em;"/></a>
        <div class="footer-text">
          <em class="copyleft">Terracotta is Open Source and freely available under the Terracotta Public License 2.0</em>
          <br/>
          <em class="copyright">&copy; Terracotta, Inc., a wholly-owned subsidiary of Software AG USA, Inc. All rights reserved.</em>
        </div>
    </div>
  </div>

</footer>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="https://maxcdn.bootstrapcdn.com/js/ie10-viewport-bug-workaround.js"></script>

<!--  <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery-scrollTo/2.1.0/jquery.scrollTo.min.js"/> -->

<script type="text/javascript">
        $('#').addClass("active");
        $('#').addClass("active");
</script>


  </body>

</html>
