<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

  <link rel="shortcut icon"  type="image/x-icon" href="/images/favicon.ico">
  <link rel="icon" type="image/x-icon" href="/images/favicon.ico">

  <title>Terracotta</title>

  <meta name="description" content="Java's most widely used cache.">

  <link rel="canonical" href="http://www.terracotta.org/documentation/4.1/terracotta-server-array/hybrid.html">
  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Terracotta Feed">


  <!-- Fonts -->
  <link href='https://fonts.googleapis.com/css?family=Lato:300,400,300italic,400italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>

  <!-- Global CSS -->

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.5/spacelab/bootstrap.min.css">


<!--
  <link rel="stylesheet" href="/plugins/highlight/styles/idea.css">
  <script src="/plugins/highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
-->

  <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
  <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/prettify.css"></script>

  <link rel="stylesheet" href="/css/main.css">

<!--
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
  <script>document.addEventListener('DOMContentLoaded', prettyPrint)</script>
-->

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

</head>


  <body>

    

    <!-- Fixed navbar -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="site-title" href="/"><img src="/images/Terracotta_Logo_sm.png" style="margin-top: 12px;"/></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li id="tc_mnu_about"><a href="/about/"><i class="fa fa-info-circle"></i> About</a></li>
            <li id="tc_mnu_docs"><a href="/documentation/"><i class="fa fa-book"></i> Docs</a></li>
            <li id="tc_mnu_download"><a href="/downloads/"><i class="fa fa-download"></i> Download</a></li>
            <li id="tc_mnu_community" class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><i class="fa fa-users"></i> Community <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li class="dropdown-header">We Love Contributors</li>
                <li><a href="/community/contribute.html"><i class="fa fa-code"></i> Contributing</a></li>
                <li><a href="/resources/"><i class="fa fa-external-link-square"></i> External Resources</a></li>
                <li><a href="/blog" target="_blank"><i class="fa fa-rss-square"></i> Terracotta Blog</a></li>
                <li role="separator" class="divider"></li>
                <li class="dropdown-header">Forums</li>
                <li><a href="https://groups.google.com/forum/#!forum/terracotta-oss" target="_blank"><i class="fa fa-commenting"></i> Users' Forum</a></li>
                <li role="separator" class="divider"></li>
                <li class="dropdown-header">Source Code</li>
                <li><a href="https://github.com/Terracotta-OSS" target="_blank"><i class="fa fa-github"></i> GitHub  Repositories</a></li>
                <li><a href="http://svn.terracotta.org/svn/tc/" target="_blank"><i class="fa fa-code-fork"></i> SVN  (Terracotta 4.x)</a></li>
                <li role="separator" class="divider"></li>
                <li class="dropdown-header">Bug Tracking</li>
                <li><a href="https://github.com/Terracotta-OSS" target="_blank"><i class="fa fa-bug"></i> GitHub  (use respective project)</a></li>
              </ul>
            </li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li id="tc_mnu_events"><a href="/events"><i class="fa fa-calendar"></i> News & Events</a></li>
            <li><a href="/blog"><i class="fa fa-rss-square"></i> Terracotta Blog</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

<br/>
<br/>
<br/>


    <div class="container-fluid">
      <div id="contentTitle">
        <h1></h1>
      </div>
      <div>
        <BR/>
        <br/>

<div class="container-fluid">

  <div class="row row-offcanvas row-offcanvas-left">

    <!-- sidebar -->
    <div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar" role="navigation">
        <ul class="nav">
          <li id="tc_mnu_docs_current" class="submenu"><a href="#current_version">Current Documentation</a></li>
          <li id="tc_mnu_doce_release_notes" class="submenu"><a href="http://www.terracotta.org/confluence/display/release/Home" target="_blank">Release Notes</a></li>
          <li id="tc_mnu_docs_previous" class="submenu"><a href="#historical_versions">Historical Versions</a></li>
        </ul>
    </div>

    <!-- main area -->
    <div class="col-xs-12 col-sm-9">
      <header class="post-header">
        
        <h1 class="post-title"></h1>
        <hr/>
        
      </header>
      <article class="post-content">
        <h1 id="bigmemory-hybrid">BigMemory Hybrid</h1><div id="toc-container">
   <table class="toc" id="toc">
      <tbody>
         <tr>
            <td>
               <ul>
                  <li class="toc_level-1 toc_section-1">
                     <a href="#bigmemory-hybrid">
                        <span class="toctext">BigMemory Hybrid</span>
                     </a>
                     <ul>
                        <li class="toc_level-2 toc_section-2">
                           <a href="#introduction">
                              <span class="toctext">Introduction</span>
                           </a>
                        </li>
                        <li class="toc_level-2 toc_section-3">
                           <a href="#system-requirements">
                              <span class="toctext">System Requirements</span>
                           </a>
                        </li>
                        <li class="toc_level-2 toc_section-4">
                           <a href="#hardware-capacity-guidelines">
                              <span class="toctext">Hardware Capacity Guidelines</span>
                           </a>
                        </li>
                        <li class="toc_level-2 toc_section-5">
                           <a href="#configuration">
                              <span class="toctext">Configuration</span>
                           </a>
                        </li>
                        <li class="toc_level-2 toc_section-6">
                           <a href="#system-operations-in-the-tmc">
                              <span class="toctext">System Operations in the TMC</span>
                           </a>
                        </li>
                        <li class="toc_level-2 toc_section-7">
                           <a href="#operator-events">
                              <span class="toctext">Operator Events</span>
                           </a>
                        </li>
                     </ul>
                  </li>
               </ul>
            </td>
         </tr>
      </tbody>
   </table>
</div>
<p>{toc|2:3}</p>

<h2 id="introduction">Introduction</h2>

<p>BigMemory Hybrid is an optional extension to BigMemory Max that:</p>

<ul>
  <li>Enables scaling up to economical solid-state drive (SSD) flash memory motionless “disks” in conjunction with conventional dynamic random-access memory (DRAM) memory. This means that the cache size can exceed the available off-heap memory.</li>
  <li>Provides predictable low latency at very large scale.</li>
  <li>
    <p>Manages the data flow seamlessly and automatically from DRAM to flash “disk” according to the size of the cache.</p>

    <p><img src="/images/documentation/hybrid1.png" alt="Hybrid Graphic" /></p>

    <p><em>Figure 1. BigMemory Hybrid allows you to expand BigMemory in Terracotta servers, keeping more data closer to your application for increased transactions per second (TPS).</em></p>
  </li>
  <li>Performs much faster than conventional hard disks, although not quite as fast as a pure DRAM in-memory solution.</li>
  <li>Supports searching, Fast Restart backup and recovery, Web Sessions, Quartz, and WAN replication.</li>
  <li>Works with industry-standard SSD devices from popular vendors, such as Fusion IO and Intel SSD.</li>
</ul>

<p>####How is BigMemory Hybrid different than Overflow to Disk?</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">BigMemory Hybrid</th>
      <th style="text-align: left">Overflow to Disk</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Available in version 4.1</td>
      <td style="text-align: left">Available in version 3.7</td>
    </tr>
    <tr>
      <td style="text-align: left">Leverages BigMemory’s Fast Restart technology</td>
      <td style="text-align: left">Depends upon Berkeley DB to store data on disk</td>
    </tr>
    <tr>
      <td style="text-align: left">Optimizes management of data between off-heap and SSD for predictable performance</td>
      <td style="text-align: left">If data does not fit in off-heap, it is pushed to disk, hence performance is less predictable</td>
    </tr>
    <tr>
      <td style="text-align: left">Optimized for SSD usage</td>
      <td style="text-align: left">No optimization done for SSDs</td>
    </tr>
  </tbody>
</table>

<h2 id="system-requirements">System Requirements</h2>

<p>BigMemory Hybrid supports writing to one single mount, so all of the BigMemory Hybrid capacity must be presented to the Terracotta process as one continuous region, which can be a single device or a RAID.</p>

<p>The mount should be used exclusively for the Terracotta server process.</p>

<p><strong>Note</strong>: System utilization is higher when using BigMemory Hybrid, and it is not recommended to run multiple servers on the same machine. Doing so could result health checkers timing out, and killing or restarting servers. Therefore, it is important to provision sufficient hardware, and it is highly recommended to deploy servers on different machines.</p>

<h2 id="hardware-capacity-guidelines">Hardware Capacity Guidelines</h2>
<p>To account for the overhead necessary for consistent performance, the formulas below are suggested as initial starting points for sizing the amount of space allocated for BigMemory Hybrid operation.</p>

<p>Minimum SSD flash memory requirement = planned total data size * 3.2</p>

<p>Minimum DRAM requirement = planned maximum number of elements * (168 + key size)</p>

<p><strong>Note</strong>: It is strongly recommended to configure enough offheap to accommodate all cache keys in DRAM.</p>

<h2 id="configuration">Configuration</h2>

<p>To configure BigMemory Hybrid, include the following elements in the <code class="highlighter-rouge">tc-config.xml</code> file:</p>

<ul>
  <li><strong>dataStorage</strong> — Specifies the maximum amount of data you plan to store on the server, using either DRAM alone or both DRAM and SSD flash memory.</li>
  <li><strong>offheap</strong>  — Specifies the maximum amount of data to hold in DRAM.</li>
  <li><strong>hybrid</strong> — Enables the Hybrid option to use SSD flash memory in addition to off-heap DRAM.</li>
</ul>

<p>For example:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;servers&gt;
    ....
    &lt;server host="hostname" name="server1"&gt;
        ...
        &lt;dataStorage size=”800g”&gt;
           &lt;offheap size=”200g”/&gt;
           &lt;hybrid/&gt;
        &lt;/dataStorage&gt;
    &lt;/server&gt;
&lt;/servers&gt;
</code></pre>
</div>

<p>For Terracotta servers, a minimum of 4 GB is recommended for the size attribute of the <code class="highlighter-rouge">offheap</code> element.</p>

<p>If the <code class="highlighter-rouge">hybrid</code> element is present, then the BigMemory Hybrid functionality is enabled. With Hybrid enabled, the value of the size attribute for the <code class="highlighter-rouge">dataStorage</code> element can exceed that of the size attribute for the  <code class="highlighter-rouge">offheap</code> element. This enables SSD devices to supplement the DRAM and be many times larger than the DRAM.</p>

<p>If the <code class="highlighter-rouge">hybrid</code> element is absent, then BigMemory Hybrid functionality is off. With Hybrid off, the value of the size attribute for the <code class="highlighter-rouge">dataStorage</code> element must be less than or equal to the value of the size attribute for the <code class="highlighter-rouge">offheap</code> element. In this case, the <code class="highlighter-rouge">offheap</code> element is not required.</p>

<p>If the <code class="highlighter-rouge">dataStorage</code> element is absent, <code class="highlighter-rouge">dataStorage</code> size and <code class="highlighter-rouge">offheap</code> size default to 512 MB.</p>

<p>Although the <code class="highlighter-rouge">dataStorage</code> element is optional, if included, this element must have a value assigned to its size attribute.</p>

<p><strong>Note</strong>: If you are migrating from BigMemory Max 4.0 to 4.1, the <code class="highlighter-rouge">dataStorage</code> element has replaced the <code class="highlighter-rouge">maxDataSize</code> element. The old element is still compatible for pure DRAM operation, but to enable Hybrid mode, you must use the new 4.1-compatible dataStorage element with the <code class="highlighter-rouge">hybrid</code> tag.</p>

<p>###Disk Storage Path
BigMemory Hybrid requires a unique and explicitly specified path. The default path is the Terracotta server’s home directory. You can customize the path using the <code class="highlighter-rouge">&lt;data&gt;</code> element in the server’s <code class="highlighter-rouge">tc-config.xml</code> configuration file.</p>

<p>###BigMemory Hybrid and Fast Restartability
If <a href="/documentation/4.1/terracotta-server-array/server-arrays#fast-restartability">Fast Restartabillity</a> is enabled, then if you have a restart, data will be loaded into BigMemory Hybrid in the same way as for BigMemory, with no difference in behavior or time required to get the system running again.</p>

<p>If <a href="/documentation/4.1/terracotta-server-array/server-arrays#fast-restartability">Fast Restartabillity</a> is not enabled, then on restart, you will have some artifacts from the previous run left on disk, and you may want to remove them. For more information, refer to <a href="/documentation/4.1/terracotta-server-array/operations#clearing-a-servers-data">Clearing a Server’s Data</a>.</p>

<h2 id="system-operations-in-the-tmc">System Operations in the TMC</h2>

<p>When you use the Terracotta Management Console (TMC), you can see the effect of the BigMemory Hybrid feature in the Monitoring &gt; Runtime Stats panel as “Data Storage Usage”.
When the cache is operating at a steady state, the Data Used typically exceeds the OffHeap Max shown in the “OffHeap Usage” graph:</p>

<p>
   <img src="/images/documentation/monitoring-graphs.png" alt="Data Used  Graphic2" />
</p>

<h2 id="operator-events">Operator Events</h2>

<p>BigMemory Hybrid supports the existing operator events in the Terracotta Server Array (TSA), including</p>

<ul>
  <li>a Throttle Mode when the amount of either RAM, Flash, or both is approaching its capacity limit.</li>
  <li>a Restricted Mode when the system has entered read-only mode.</li>
</ul>

<p>For more information about TSA operations, see <a href="/documentation/4.1/terracotta-server-array/operations#automatic-resource-management">Automatic Resource Management</a> and <a href="/documentation/4.1/terracotta-server-array/operations#automatic-resource-management">Near-Memory-Full Conditions</a>.</p>

      </article>
    </div>

  </div>

</div>

      </div>
    </div>

    <br/>
<footer class="site-footer">

  <div class="container">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        Related Projects:<br/>
        <a href="http://www.ehcache.org"><img src="/images/ehcache.png" style=""></a><br/><br/>
        <a href="http://www.quartz-scheduler.org"><img src="/images/logo-quartz-scheduler.png" style="max-height: 32px;"></a>

        <!--
        <ul class="contact-list">
          <li>Terracotta</li>
          <li><a href="mailto:tc-oss@softwareag.com">tc-oss@softwareag.com</a></li>
        </ul>
      -->
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/terracotta-oss">
              <i class="fa fa-github"></i> GitHub
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/terracottatech">
              <i class="fa fa-twitter"></i> Twitter
            </a>
          </li>
          

          
          <li>
            <a href="http://www.facebook.com/Terracotta">
              <i class="fa fa-facebook"></i> Facebook
            </a>
          </li>
          

          
          <li>
            <a href="http://www.linkedin.com/company/terracotta">
              <i class="fa fa-linkedin"></i> LinkedIn
            </a>
          </li>
          

          <li>
            <a href="/feed.xml" title="Atom/RSS Feed">
              <i class="fa fa-rss-square"></i> Atom/RSS Feed
            </a>
          </li>
        </ul>
      </div>

    <div class="footer-col  footer-col-3">
      <a href="/downloads/"><i class="fa fa-download"></i> Download Now</a>
      <br/>
      <a href="/documentation/"><i class="fa fa-book"></i> Documentation</a>
      <br/>
      <a href="/resources/"><i class="fa fa-external-link-square"></i> Resources</a>
      <br/>
      <a href="/blog/"><i class="fa fa-rss-square"></i> Terracotat Blog</a>
      <br/>
      <a href="/community/"><i class="fa fa-users"></i> Join the Community</a>
    </div>

    </div>

    <div class="container-fluid">
        <hr/>
        <em class="copyleft">Terracotta is Open Source and freely available under the Terracotta Public License 2.0</em>
        <br/>
        <em class="copyright">&copy; Terracotta, Inc., a wholly-owned subsidiary of Software AG USA, Inc. All rights reserved.</em>
    </div>
  </div>

</footer>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="https://maxcdn.bootstrapcdn.com/js/ie10-viewport-bug-workaround.js"></script>

<!--  <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery-scrollTo/2.1.0/jquery.scrollTo.min.js"/> -->

<script type="text/javascript">
        $('#').addClass("active");
        $('#').addClass("active");

        //delayed init for documents that need init code that relies on jQuery
        //but jQuery is loaded in the footer
        $(document).ready(function() {
          if(typeof delayedInitHandler == 'function'){
            delayedInitHandler();
          }
        })
</script>


  </body>

</html>
