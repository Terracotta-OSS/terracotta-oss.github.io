<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

  <link rel="shortcut icon"  type="image/x-icon" href="/images/favicon.ico">
  <link rel="icon" type="image/x-icon" href="/images/favicon.ico">

  <title>Terracotta</title>

  <meta name="description" content="Java's most widely used cache.">

  <link rel="canonical" href="http://www.terracotta.org/documentation/4.1/terracotta-server-array/tsa-ldap.html">
  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Terracotta Feed">


  <!-- Fonts -->
  <link href='https://fonts.googleapis.com/css?family=Lato:300,400,300italic,400italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>

  <!-- Global CSS -->

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.5/spacelab/bootstrap.min.css">


<!--
  <link rel="stylesheet" href="/plugins/highlight/styles/idea.css">
  <script src="/plugins/highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
-->

  <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
  <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/prettify.css"></script>

  <link rel="stylesheet" href="/css/main.css">

<!--
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
  <script>document.addEventListener('DOMContentLoaded', prettyPrint)</script>
-->

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

</head>


  <body>

    

    <!-- Fixed navbar -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="site-title" href="/"><img src="/images/Terracotta_Logo_sm.png" style="margin-top: 12px;"/></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li id="tc_mnu_about"><a href="/about/"><i class="fa fa-info-circle"></i> About</a></li>
            <li id="tc_mnu_docs"><a href="/documentation/"><i class="fa fa-book"></i> Docs</a></li>
            <li id="tc_mnu_download"><a href="/downloads/"><i class="fa fa-download"></i> Download</a></li>
            <li id="tc_mnu_community" class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><i class="fa fa-users"></i> Community <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li class="dropdown-header">We Love Contributors</li>
                <li><a href="/community/contribute.html"><i class="fa fa-code"></i> Contributing</a></li>
                <li><a href="/resources/"><i class="fa fa-external-link-square"></i> External Resources</a></li>
                <li><a href="/blog" target="_blank"><i class="fa fa-rss-square"></i> Terracotta Blog</a></li>
                <li role="separator" class="divider"></li>
                <li class="dropdown-header">Forums</li>
                <li><a href="https://groups.google.com/forum/#!forum/terracotta-oss" target="_blank"><i class="fa fa-commenting"></i> Users' Forum</a></li>
                <li role="separator" class="divider"></li>
                <li class="dropdown-header">Source Code</li>
                <li><a href="https://github.com/Terracotta-OSS" target="_blank"><i class="fa fa-github"></i> GitHub  Repositories</a></li>
                <li><a href="http://svn.terracotta.org/svn/tc/" target="_blank"><i class="fa fa-code-fork"></i> SVN  (Terracotta 4.x)</a></li>
                <li role="separator" class="divider"></li>
                <li class="dropdown-header">Bug Tracking</li>
                <li><a href="https://github.com/Terracotta-OSS" target="_blank"><i class="fa fa-bug"></i> GitHub  (use respective project)</a></li>
              </ul>
            </li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li id="tc_mnu_events"><a href="/events"><i class="fa fa-calendar"></i> News & Events</a></li>
            <li><a href="/blog"><i class="fa fa-rss-square"></i> Terracotta Blog</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

<br/>
<br/>
<br/>


    <div class="container-fluid">
      <div id="contentTitle">
        <h1></h1>
      </div>
      <div>
        <BR/>
        <br/>

<div class="container-fluid">

  <div class="row row-offcanvas row-offcanvas-left">

    <!-- sidebar -->
    <div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar" role="navigation">
        <ul class="nav">
          <li id="tc_mnu_docs_current" class="submenu"><a href="#current_version">Current Documentation</a></li>
          <li id="tc_mnu_doce_release_notes" class="submenu"><a href="http://www.terracotta.org/confluence/display/release/Home" target="_blank">Release Notes</a></li>
          <li id="tc_mnu_docs_previous" class="submenu"><a href="#historical_versions">Historical Versions</a></li>
        </ul>
    </div>

    <!-- main area -->
    <div class="col-xs-12 col-sm-9">
      <header class="post-header">
        
        <h1 class="post-title"></h1>
        <hr/>
        
      </header>
      <article class="post-content">
        <h1 id="setting-up-ldap-based-authentication">Setting Up LDAP-Based Authentication</h1><div id="toc-container">
   <table class="toc" id="toc">
      <tbody>
         <tr>
            <td>
               <ul>
                  <li class="toc_level-1 toc_section-1">
                     <a href="#setting-up-ldap-based-authentication">
                        <span class="toctext">Setting Up LDAP-Based Authentication</span>
                     </a>
                     <ul>
                        <li class="toc_level-2 toc_section-2">
                           <a href="#introduction">
                              <span class="toctext">Introduction</span>
                           </a>
                        </li>
                        <li class="toc_level-2 toc_section-3">
                           <a href="#configuration-overview">
                              <span class="toctext">Configuration Overview</span>
                           </a>
                        </li>
                        <li class="toc_level-2 toc_section-4">
                           <a href="#active-directory-configuration">
                              <span class="toctext">Active Directory Configuration</span>
                           </a>
                        </li>
                        <li class="toc_level-2 toc_section-5">
                           <a href="#standard-ldap-configuration">
                              <span class="toctext">Standard LDAP Configuration</span>
                           </a>
                        </li>
                        <li class="toc_level-2 toc_section-6">
                           <a href="#using-the-cdata-construct">
                              <span class="toctext">Using the CDATA Construct</span>
                           </a>
                        </li>
                     </ul>
                  </li>
               </ul>
            </td>
         </tr>
      </tbody>
   </table>
</div>
<p>{toc|2:3}</p>

<h2 id="introduction">Introduction</h2>

<p>Note: For a brief overview of Terracotta security with links to individual topics, see <a href="/documentation/4.1/bigmemorymax/security-overview">Security Overview</a>.</p>

<p>Instead of using the <a href="/documentation/4.1/terracotta-server-array/tsa-security#set-up-authentication">built-in user management system</a>, you can set up authentication and authorization for the Terracotta Server Array (TSA) based on the Lightweight Directory Access Protocol (LDAP). This allows you to use your existing security infrastructure for controlling access to Terracotta clusters.</p>

<p>The two types of LDAP-based authentication supported are Microsoft Active Directory and standard LDAP. In addition, LDAPS (LDAP over SSL) is supported.</p>

<p><strong>NOTE:</strong> Terracotta servers must be <a href="tsa-security">configured to use SSL</a> before any Active Directory or standard LDAP can be used.</p>

<p><strong>NOTE:</strong> This topic assumes that the reader has knowledge of standard LDAP concepts and usage.</p>

<h2 id="configuration-overview">Configuration Overview</h2>
<p>Active Directory and standard LDAP are configured in the &lt;auth&gt; section of each server’s configuration block:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;servers secure="true"&gt;
  &lt;server host="172.16.254.1" name="server1"&gt;
    ...
    &lt;security&gt;
      ...
      &lt;auth&gt;
        &lt;realm&gt;...&lt;/realm&gt;
        &lt;url&gt;...&lt;/url&gt;
        &lt;user&gt;...&lt;/user&gt;
      &lt;/auth&gt;
    &lt;/security&gt;
...
&lt;/server&gt;
</code></pre>
</div>

<p>Active Directory and standard LDAP are configured using the &lt;realm&gt; and &lt;url&gt; elements; the &lt;user&gt; element is used for <a href="tsa-security#keychain">connections between Terracotta servers</a> and is not required for LDAP-related configuration.</p>

<p>For presentation, the URLs used in this document use line breaks. <strong>Do not use line breaks</strong> when creating URLs in your configuration.</p>

<h3 id="realms-and-roles">Realms and Roles</h3>
<p>The setup for LDAP-based authentication and authorization uses Shiro realms to map user groups to one of the following two roles:</p>

<ul>
  <li>admin – The user with the admin role is the initial user who sets up security. Thereafter, the user with the admin role performs system functions such as shutting down servers, clearing or deleting caches and cache managers, and reloading configuration.</li>
  <li>terracotta – The operator role is required to log in to the TMC, so even a user with the admin role must have the operator role. Thereafter, the person with the operator role can connect to the TMC and add connections.</li>
</ul>

<h3 id="url-encoding">URL Encoding</h3>
<p>Certain characters used in the LDAP URL must be encoded, unless <a href="#cdata">wrapped in a CDATA construct</a>. Characters that may be required in an LDAP URL are described below:</p>

<ul>
  <li>&amp; (ampersand) – Encode as %26.</li>
  <li>{ (left brace) – Encode as %7B.</li>
  <li>} (right brace) – Encode as %7D.</li>
  <li>Space – Encode as %20. <em>Spaces must always be encoded</em>, even if wrapped in CDATA.</li>
  <li>= (equals sign) – Does not require encoding.</li>
</ul>

<h2 id="active-directory-configuration">Active Directory Configuration</h2>
<p>Specify the realm and URL in the &lt;security&gt; section of the Terracotta configuration as follows:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;auth&gt;
  &lt;realm&gt;com.tc.net.core.security.ShiroActiveDirectoryRealm&lt;/realm&gt;
  &lt;url&gt;ldap://admin_user@server_address:server_port/searchBase=search_domain%26
       groupBindings=groups_to_roles&lt;/url&gt;
  &lt;user&gt;&lt;/user&gt;
&lt;/auth&gt;
</code></pre>
</div>

<p>Note the value of the &lt;realm&gt; element, which must specify the correct class (or Shiro security realm) for Active Directory. The components of the URL are defined in the following table.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Component</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">ldap://</td>
      <td style="text-align: left">For the scheme, use either <code class="highlighter-rouge">ldap://</code> or <code class="highlighter-rouge">ldaps://</code>.</td>
    </tr>
    <tr>
      <td style="text-align: left">admin_user</td>
      <td style="text-align: left">The name of a user with sufficient rights in Active Directory to perform a search in the domain specified by searchBase. The password for this user password must be stored in the Terracotta keychain used by the Terracotta server, using as key the root of the LDAP URI, <code class="highlighter-rouge">ldap://admin_user@server_name:server_port</code>, with no trailing slash (“/”).</td>
    </tr>
    <tr>
      <td style="text-align: left">server_address:server_port</td>
      <td style="text-align: left">The IP address or resolvable fully qualified domain name of the server, and the port for Active Directory.</td>
    </tr>
    <tr>
      <td style="text-align: left">searchBase</td>
      <td style="text-align: left">Specifies the Active Directory domain to be searched. For example, if the Active Directory domain is reggae.jamaica.org, then the format is <code class="highlighter-rouge">searchBase=dc=reggae,dc=jamaica,dc=org</code>.</td>
    </tr>
    <tr>
      <td style="text-align: left">groupBindings</td>
      <td style="text-align: left">Specifies the mappings between Active Directory groups and Terracotta roles. For example, <code class="highlighter-rouge">groupBindings=Domain%20Admins=admin,Users=terracotta</code> maps the  Active Directory groups “Domain Admins” and “Users” to the “admin” and “terracotta” Terracotta roles, respectively. To be mapped, the named Active Directory groups must be part of the domain specified in searchBase; all other groups (including those with the specified names) in other domains are ignored.</td>
    </tr>
  </tbody>
</table>

<p>For example:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;auth&gt;
  &lt;realm&gt;com.tc.net.core.security.ShiroActiveDirectoryRealm&lt;/realm&gt;
  &lt;url&gt;ldap://bmarley@172.16.254.1:389?searchBase=dc=reggae,dc=jamaica,dc=org%26
       groupBindings=Domain%20Admins=admin,Users=terracotta&lt;/url&gt;
  &lt;user&gt;&lt;/user&gt;
&lt;/auth&gt;
</code></pre>
</div>

<h2 id="standard-ldap-configuration">Standard LDAP Configuration</h2>
<p>Specify the realm and URL in the &lt;security&gt; section of the Terracotta configuration as follows:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;auth&gt;
  &lt;realm&gt;com.tc.net.core.security.ShiroLdapRealm&lt;/realm&gt;
  &lt;url&gt;ldap://directory_manager@myLdapServer:636?
       userDnTemplate=cn=%7B0%7D,ou=users,dc=mycompany,dc=com%26
       groupDnTemplate=cn=%7B0%7D,ou=groups,dc=mycompany,dc=com%26
       groupAttribute=uniqueMember%26
       groupBindings=bandleaders=admin,bandmembers=terracotta&lt;/url&gt;
  &lt;user&gt;&lt;/user&gt;
&lt;/auth&gt;
</code></pre>
</div>

<p>Note the value of the &lt;realm&gt; element, which must specify the correct class (or Shiro security realm) for Active Directory. The components of the URL are defined in the following table.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Component</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">ldap://</td>
      <td style="text-align: left">For the scheme, use either <code class="highlighter-rouge">ldap://</code> or <code class="highlighter-rouge">ldaps://</code>.</td>
    </tr>
    <tr>
      <td style="text-align: left">directory_manager</td>
      <td style="text-align: left">The name of a user with sufficient rights on the LDAP server to perform searches. No user is required if anonymous lookups are allowed. If a user is required, the user’s password must be stored in the Terracotta keychain, using as key the root of the LDAP URL, <code class="highlighter-rouge">ldap://admin_user@server_name:server_port</code>, with no trailing slash (“/”).</td>
    </tr>
    <tr>
      <td style="text-align: left">server_address:server_port</td>
      <td style="text-align: left">The IP address or resolvable fully qualified domain name of the server, and the LDAP server port.</td>
    </tr>
    <tr>
      <td style="text-align: left">userDnTemplate</td>
      <td style="text-align: left">Specifies user-template values. See the example below.</td>
    </tr>
    <tr>
      <td style="text-align: left">groupDnTemplate</td>
      <td style="text-align: left">Specifies group-template values. See the example below.</td>
    </tr>
    <tr>
      <td style="text-align: left">groupAttribute</td>
      <td style="text-align: left">Specifies the LDAP group attribute whose value uniquely identifies a user. By default, this is “uniqueMember”. See the example below.</td>
    </tr>
    <tr>
      <td style="text-align: left">groupBindings</td>
      <td style="text-align: left">Specifies the mappings between LDAP groups and Terracotta roles. For example, <code class="highlighter-rouge">groupBindings=bandleaders=admin,bandmembers=terracotta</code> maps the LDAP groups “bandleaders” and “bandmembers” to the “admin” and “terracotta” Terracotta roles, respectively.</td>
    </tr>
  </tbody>
</table>

<p>For example:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;auth&gt;
  &lt;realm&gt;com.tc.net.core.security.ShiroLdapRealm&lt;/realm&gt;
  &lt;url&gt;ldap://dizzy@172.16.254.1:636?
       userDnTemplate=cn=%7B0%7D,ou=users,dc=mycompany,dc=com%26
       groupDnTemplate=cn=%7B0%7D,ou=groups,dc=mycompany,dc=com%26
       groupAttribute=uniqueMember%26
       groupBindings=bandleaders=admin,bandmembers=terracotta&lt;/url&gt;
  &lt;user&gt;&lt;/user&gt;
&lt;/auth&gt;
</code></pre>
</div>

<p>This implies the LDAP directory structure is set up similar to the following:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>+ dc=com  
    + dc=mycompany  
        + ou=groups  
            + cn=bandleaders  
                  | uniqueMember=dizzy
                  | uniqueMember=duke
            + cn=bandleaders
                  | uniqueMember=art
                  | uniqueMember=bird
</code></pre>
</div>

<p>If, however, the the LDAP directory structure is set up similar to the following:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>+ dc=com  
    + dc=mycompany  
        + ou=groups  
            + cn=bandleaders  
                  | musician=dizzy
                  | musician=duke
            + cn=bandleaders
                  | musician=art
                  | musician=bird
</code></pre>
</div>

<p>then the value of groupAttribute should be “musician”.</p>

<p>
   <a id="cdata"></a>
</p>
<h2 id="using-the-cdata-construct">Using the CDATA Construct</h2>
<p>To avoid encoding the URL, wrap it in a CDATA construct as shown:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;url&gt;&lt;![CDATA[ldap://dizzy@172.16.254.1:636?
     userDnTemplate=cn={0},ou=users,dc=mycompany,dc=com&amp;
     groupDnTemplate=cn={0},ou=groups,dc=mycompany,dc=com&amp;
     groupAttribute=uniqueMember&amp;
     groupBindings=bandleaders=admin,bandmembers=terracotta]]&gt;&lt;/url&gt;
</code></pre>
</div>

      </article>
    </div>

  </div>

</div>

      </div>
    </div>

    <br/>
<footer class="site-footer">

  <div class="container">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        Related Projects:<br/>
        <a href="http://www.ehcache.org"><img src="/images/ehcache.png" style=""></a><br/><br/>
        <a href="http://www.quartz-scheduler.org"><img src="/images/logo-quartz-scheduler.png" style="max-height: 32px;"></a>

        <!--
        <ul class="contact-list">
          <li>Terracotta</li>
          <li><a href="mailto:tc-oss@softwareag.com">tc-oss@softwareag.com</a></li>
        </ul>
      -->
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/terracotta-oss">
              <i class="fa fa-github"></i> GitHub
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/terracottatech">
              <i class="fa fa-twitter"></i> Twitter
            </a>
          </li>
          

          
          <li>
            <a href="http://www.facebook.com/Terracotta">
              <i class="fa fa-facebook"></i> Facebook
            </a>
          </li>
          

          
          <li>
            <a href="http://www.linkedin.com/company/terracotta">
              <i class="fa fa-linkedin"></i> LinkedIn
            </a>
          </li>
          

          <li>
            <a href="/feed.xml" title="Atom/RSS Feed">
              <i class="fa fa-rss-square"></i> Atom/RSS Feed
            </a>
          </li>
        </ul>
      </div>

    <div class="footer-col  footer-col-3">
      <a href="/downloads/"><i class="fa fa-download"></i> Download Now</a>
      <br/>
      <a href="/documentation/"><i class="fa fa-book"></i> Documentation</a>
      <br/>
      <a href="/resources/"><i class="fa fa-external-link-square"></i> Resources</a>
      <br/>
      <a href="/blog/"><i class="fa fa-rss-square"></i> Terracotat Blog</a>
      <br/>
      <a href="/community/"><i class="fa fa-users"></i> Join the Community</a>
    </div>

    </div>

    <div class="container-fluid">
        <hr/>
        <em class="copyleft">Terracotta is Open Source and freely available under the Terracotta Public License 2.0</em>
        <br/>
        <em class="copyright">&copy; Terracotta, Inc., a wholly-owned subsidiary of Software AG USA, Inc. All rights reserved.</em>
    </div>
  </div>

</footer>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="https://maxcdn.bootstrapcdn.com/js/ie10-viewport-bug-workaround.js"></script>

<!--  <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery-scrollTo/2.1.0/jquery.scrollTo.min.js"/> -->

<script type="text/javascript">
        $('#').addClass("active");
        $('#').addClass("active");

        //delayed init for documents that need init code that relies on jQuery
        //but jQuery is loaded in the footer
        $(document).ready(function() {
          if(typeof delayedInitHandler == 'function'){
            delayedInitHandler();
          }
        })
</script>


  </body>

</html>
